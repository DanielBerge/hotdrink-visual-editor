!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hd",[],t):"object"==typeof exports?exports.hd=t():e.hd=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={84:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.retainingVariableListener=function(e,t,n=(()=>{}),r=(()=>{}),s=(()=>{})){let o;const a=()=>{o.unsubscribe();const i=e.value;null!=i&&(o=u(i,t,n,r,a)),s(null!=i)};return o=u(e,t,n,r,a),new i.SimpleSubscription((()=>o.unsubscribe()))},t.variableListener=u;var r=a(n(927)),s=a(n(831)),o=n(775),i=n(534);function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n=(()=>{}),i=(e=>{}),a=(()=>{})){let u;if(e instanceof s.default){if(null==e.value)throw new Error("Cannot subscribe to a danging variable");o.hdconsole.assert(e.value instanceof r.default,"VariableReference does not hold an instance of Variable"),u=e.value}else u=e;if(null==u)throw new Error("variable is null");const l={next:e=>{let r="???";try{void 0!==e.error||!0===e.inError?(r="onError",i(e.error)):!0===e.pending?(r="onPending",n()):void 0!==e.value&&(r="onChange",t(e.value))}catch(t){o.hdconsole.warn(`Variable listener threw exception in ${r} (given event ${JSON.stringify(e)}):`,t)}},error:i,complete:a};return u.subscribe(l)}},673:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bidirectionalElementListener=c,t.elementAttributeBinder=function(e,t,n="value",r="change",s=0,o=((...e)=>{}),i=((...e)=>{})){if(!(n in t))throw new Error(`Failed to find attribute '${n}' in given element`);return c(e,t,r,s,((e,t,r)=>{o(null!=e?e:null,t,r);try{r[n]=e}catch(t){u.hdconsole.error(`Failed to set attribute '${n}' in element with id '${r.id}' to '${e}'`,t)}}),((e,t,r)=>{var s;if("checkValidity"in r&&"function"==typeof r.checkValidity&&!1===r.checkValidity())return;const o=null!==(s=r[n])&&void 0!==s?s:null;i(o,t,r),t.set(o)}))};var r=l(n(927)),s=l(n(831)),o=n(534),i=n(84),a=n(292),u=n(775);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n="change",u=0,l,c){let h,f;if(e instanceof s.default)h=e;else{if(!(e instanceof r.default))throw new Error("Not given a variable or VariableReference");h=e.owner}if(u>0){let e;f=n=>{clearTimeout(e),e=setTimeout((()=>c(n,(0,a.variableFromReference)(h),t)),u)}}else f=e=>c(e,(0,a.variableFromReference)(h),t);t.addEventListener(n,f);let d=(0,i.retainingVariableListener)(h,(e=>l(e,(0,a.variableFromReference)(h),t)));return d.additionalSubscriptions.push(new o.SimpleSubscription((()=>t.removeEventListener(n,f)))),d}},329:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VariableActivation=t.TrackingPromise=t.MethodActivation=t.EvaluationGraph=t.Deferred=void 0,(r=n(927))&&r.__esModule;var r,s=n(292),o=n(268);class i{constructor(){this._promise=new Promise(((e,t)=>{this.resolve=t=>{e(t)},this.reject=e=>{t(e)}}))}get promise(){return this._promise}}t.Deferred=i;class a{constructor(e,t){this._promise=e,this._fulfillTracker=t}then(e,t){return null!=e&&this._fulfillTracker(),this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}}t.TrackingPromise=a;class u{constructor(e){this._pending=!1,this._variable=e,this._deferred=new i,this._outMethods=new Set,this._inMethod=null,(0,o.mkRefCounted)(this,(e=>{e.reject(u.abandoned),e._inMethod=null}))}get name(){return this._variable.name}get inMethod(){return this._inMethod}get outMethods(){return this._outMethods}outMethodsSize(){return this._outMethods.size}addOutMethod(e){this._outMethods.add(e)}setInMethod(e){this._inMethod=e}resolve(e){return this._pending=!1,this._deferred.resolve(e)}reject(e){return this._pending=!1,this._deferred.reject(e)}get promise(){return this._deferred.promise}}t.VariableActivation=u,u.abandoned={},t.MethodActivation=class{constructor(e,t){this._f=e,this._mask=t}get ins(){return this._ins}get outs(){return this._outs}insSize(){return this._ins.length}outsSize(){return this._outs.length}async execute(e,t){this._ins=e,this._outs=t,t.forEach((e=>e.setInMethod(this))),e.forEach((e=>(0,o.retain)(e)));let n=t.map((e=>e.promise.then((e=>null),(e=>null))));Promise.all(n).then((()=>{e.forEach((e=>{(0,o.release)(e)}))}));let r,u=e.filter(((e,t)=>0==(this._mask[t]&s.maskPromise))),l=e.filter(((e,t)=>0!=(this._mask[t]&s.maskUpdate))),c=l.length;if(c>0){let e=new i,t=[];for(let n=0;n<l.length;++n)t.push(l[n].name),(0,o.setUniqueHandler)(l[n],(t=>{0==--c&&e.resolve(null)}));await e.promise}try{r=await Promise.all(u.map((e=>e.promise)))}catch(e){return void t.forEach((e=>e.reject("a method's input was rejected")))}let h,f=[],d=0;for(let t=0;t<e.length;++t)0!=(this._mask[t]&s.maskPromise)?f[t]=new a(e[t].promise,(()=>e[t].addOutMethod(this))):(e[t].addOutMethod(this),f[t]=r[d++]);try{h=await this._f(...f)}catch(e){return void t.forEach((t=>t.reject(e)))}if(t.length>1){console.assert(Array.isArray(h)&&t.length===h.length,`Method result should be an array of ${t.length} elements`);for(let e=0;e<h.length;++e)t[e].resolve(h[e])}else t[0].resolve(h)}},t.EvaluationGraph=class{adjacentOutVertices(e){return e instanceof u?e.outMethods:e.outs}outDegree(e){return e instanceof u?e.outMethodsSize():e.outsSize()}adjacentInVertices(e){return e instanceof u?null!=e.inMethod?[e.inMethod]:[]:e.ins}inDegree(e){return e instanceof u?null!=e.inMethod?1:0:e.insSize()}}},230:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEFT=t.ComponentScope=void 0,Object.defineProperty(t,"ParseState",{enumerable:!0,get:function(){return r.ParseState}}),t.TypeError=t.SetScope=t.RIGHT=void 0,t.asLeft=d,t.asRight=p,t.block=void 0,t.buildComponent=q,t.checkComponent=M,t.checkConstraint=S,t.checkFirstMethod=w,t.checkOtherMethod=k,t.checkParameterList=g,t.checkQualifiers=y,t.component=function(e,...t){let n=(0,r.hdl)(e,...t),s=(0,r.must)((0,r.pBind_)(r.manyws,(0,r.oneOf)(B,J((0,a.freshComponentName)()))))(n);return(0,r.must)(r.eof)(n),q(p(M(s.value)))},t.functionBody=void 0,Object.defineProperty(t,"hdl",{enumerable:!0,get:function(){return r.hdl}}),t.isLeft=f,t.isRight=function(e){return 1===e.tag},t.jsCode=x,t.left=c,Object.defineProperty(t,"mkParseState",{enumerable:!0,get:function(){return r.mkParseState}}),t.pComponent=B,t.pConstraint=z,t.pMethod=V,t.pVariables=A,t.qualifiedParameterList=R,t.qualifierList=T,t.right=h,t.stringLiteral=C,t.templateLiteral=j,t.topComponent=J,t.withPos=_,l(n(779));var r=n(316),s=(n(877),l(n(894))),o=l(n(916)),i=l(n(137)),a=(l(n(831)),n(292)),u=n(268);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return{tag:0,value:e}}function h(e){return{tag:1,value:e}}function f(e){return 0===e.tag}function d(e){if(0!==e.tag)throw"Either cast error: no value on left";return e.value}function p(e){if(1!==e.tag)throw e.value;return e.value}function _(e){return(0,r.lift2)(((e,t)=>({pos:e,value:t})))(r.currentPos,e)}t.LEFT=0,t.RIGHT=1;class m{constructor(e){this._component=e}get(e){let t=this._component;for(;null!=t;){let n=t.variableDeclarations.get(e);if(void 0!==n)return n;t=t.parent}}has(e){return void 0!==this.get(e)}}t.ComponentScope=m;class v{constructor(e){this._set=e}get(e){return this.has(e)?e:void 0}has(e){return this._set.has(e)}}t.SetScope=v;class b extends Error{constructor(e,t){super(),this._msg=e,this._pos=t}get message(){return this._pos.toString()+"\n"+this._msg}set message(e){throw Error("Cannot set the name of ParseError")}}function y(e){if(e.length>1){let t=new Set;for(let n of e){if(t.has(n.value))return c(new b(`The same qualifier ${n.value} appears twice`,n.pos));t.add(n.value)}}return h(null)}function g(e,t){let n=new Set;for(let r of e){let e=y(r.value.qualifiers);if(f(e))return c(d(e));let s=r.value.parameterName;if(!t.has(s.value))return c(new b(`Undefined variable name ${s.value}`,s.pos));if(n.has(s.value))return c(new b(`Parameter ${s.value} appears twice in the same parameter list`,s.pos));n.add(s.value)}return h(n)}function w(e,t){let n=g(e.ins,t);if(f(n))return n;let r=g(e.outs,t);return f(r)?r:h((0,u.setUnion)(p(n),p(r)))}function k(e,t){let n=new v(t),r=g(e.ins,n);if(f(r))return c(d(r));let s=g(e.outs,n);if(f(s))return c(d(s));let o=(0,u.setUnion)(p(r),p(s));if(!(0,u.setEquals)(o,t)){let n=Array.from((0,u.setDifference)(t,o)).join();return c(new b("All methods in the same constraint must use the same variables; this method does not refer to variable "+n,e.pos))}return h(null)}function S(e,t){if(0===e.methods.length)return e.variableNames=new Set,h(e);let n=w(e.methods[0],t);if(f(n))return c(d(n));e.variableNames=p(n);for(let t=1;t<e.methods.length;++t){let r=k(e.methods[t],p(n));if(f(r))return c(d(r))}return h(e)}function M(e){for(let t of e.constraints){let n=S(t,new m(e));if(f(n))return c(d(n))}for(let t of e.components){let e=M(t);if(f(e))return c(d(e))}return h(e)}function x(e,t=!0){return n=>{let s="";for(;;){let o=n.peek();if(null==o)return e.includes("")?(0,r.ok)(s,s.length>0):(0,r.failF)((()=>["<js code>"].concat(e)),s.length>0);if(e.includes(o))return t&&((0,r.item)(n),s+=o),(0,r.ok)(s);if(["}","]",")"].includes(o))return(0,r.fail)(["not "+o],!0);let i=(0,r.oneOf)(C,j,(0,r.pBind)((0,r.sat)(O),(e=>(0,r.pBind)(x([P(e)],!0),(t=>(0,r.ret)(e+t))))),r.item)(n);if(!i.success)return i;s+=i.value}throw null}}function O(e){return"("===e||"{"===e||"["===e}function P(e){switch(e){case"(":return")";case"{":return"}";case"[":return"]"}throw Error("HotDrink internal error: no closing brace defined for "+e)}function C(e){let t=(0,r.oneOf)((0,r.pChar)("'"),(0,r.pChar)('"'))(e);if(!t.success)return t;const n=t.value,s="\\"+n;let o=t.value;return t=(0,r.lift)(((e,t)=>o+e.join("")+t),(0,r.many)((0,r.oneOf)((0,r.exactString)("\\\\"),(0,r.exactString)(s),(0,r.sat)((e=>e!==n)))),(0,r.pChar)(n))(e),t.consumed=!0,t}function j(e){const t="`";let n=(0,r.pChar)(t)(e);if(!n.success)return n;let s=n.value;for(;;){let n=(0,r.must)((0,r.oneOf)((0,r.pChar)(t),(0,r.exactString)("${"),(0,r.exactString)("\\\\"),(0,r.exactString)("\\`"),r.item))(e);if(n.value===t){s+=t;break}"${"!==n.value?s+=n.value:(s+="${",s+=(0,r.must)(x(["}"]))(e).value)}return(0,r.ok)(s)}t.TypeError=b;const E=(0,r.context)("<function body block>",(0,r.token)((0,r.lift)(((e,t)=>e+t),(0,r.pChar)("{"),x(["}"]))));t.block=E;const N=(0,r.context)("<function body>",(0,r.oneOf)(E,(0,r.pBind)((0,r.token)(x([";"])),(e=>(0,r.ret)("return "+e)))));function V(e){const t=_((0,r.oneOf)((0,r.lift)(((e,t)=>e),r.pSplice,(0,r.word)(";")),(0,r.pBind_)((0,r.word)("=>"),N),E));return(0,r.context)("<method>",(0,r.lift)((function(e,t,n,r,s){let o=n.map((e=>(0,u.foldl)(((e,t)=>function(e){switch(e){case"*":return a.maskPromise;case"!":return a.maskUpdate;default:return a.maskNone}}(e)|t),a.maskNone,e.value.qualifiers.map((e=>e.value)))));const i=n.map((e=>e.value.parameterName.value));let l;return l="string"==typeof s.value?{pos:s.pos,value:new Function(i.join(),s.value)}:s,{pos:e,name:t,ins:n,outs:r,code:l,promiseMask:o}}),r.currentPos,(0,r.opt)(_(r.identifier),null),(0,r.ignore)((0,r.word)("(")),R("*!"),(0,r.ignore)((0,r.word)("->")),R(""),(0,r.ignore)((0,r.word)(")")),t))(e)}function T(e){return(0,r.many)((0,r.token)(_((0,r.pChars)(e))))}function R(e="*!"){return(0,r.sepList)(_((0,r.lift)(((e,t)=>({qualifiers:e,parameterName:t})),T(e),_(r.identifier))),(0,r.word)(","))}function A(e){return(0,r.inBetween)((0,r.sepList)(D,(0,r.word)(",")),(0,r.word)("var"),(0,r.word)(";"))(e)}function D(e){return(0,r.pBind)(r.currentPos,(e=>(0,r.oneOf)((0,r.lift)((t=>({pos:e,name:t,isReference:!0})),(0,r.ignore)((0,r.word)("&")),r.identifier),(0,r.lift)(((t,n)=>({pos:e,name:t,isReference:!1,initializer:n})),r.identifier,(0,r.opt)(_(F),void 0)))))(e)}function F(e){return(0,r.pBind_)((0,r.word)("="),(0,r.context)("<intitializer-expression>",(0,r.pBind)(x([",",";"],!1),(e=>(0,r.ret)(new Function("return "+e)())))))(e)}function z(e){return(0,r.context)("<constraint>",(0,r.lift)(((e,t,n)=>({pos:e,name:t,variableNames:null,methods:n})),r.currentPos,(0,r.ignore)((0,r.word)("constraint")),(0,r.opt)(_(r.identifier),null),(0,r.ignore)((0,r.word)("{")),(0,r.many)(V),(0,r.ignore)((0,r.word)("}"))))(e)}t.functionBody=N;const I=(e,t,n)=>{let r=new Map,s=[],o=[],i={parent:null,pos:e,name:t,variableDeclarations:r,constraints:s,components:o};for(let e of n)switch(e.tag){case"variable":for(let t of e.value)r.set(t.name,t);break;case"constraint":s.push(e.value);break;case"component":e.value.parent=i,o.push(e.value)}return i},$=(0,r.many)((0,r.oneOf)((0,r.pBind)(A,(e=>(0,r.ret)({tag:"variable",value:e}))),(0,r.pBind)(z,(e=>(0,r.ret)({tag:"constraint",value:e}))),(0,r.pBind)(B,(e=>(0,r.ret)({tag:"component",value:e})))));function J(e){return t=>(0,r.lift)(I,r.currentPos,_((0,r.ret)(e)),$)(t)}function B(e){return(0,r.context)("<component>",(0,r.lift)(I,r.currentPos,(0,r.ignore)((0,r.word)("component")),_(r.identifier),(0,r.ignore)((0,r.word)("{")),$,(0,r.ignore)((0,r.word)("}"))))(e)}function q(e,t=null){let n=new s.default(e.name.value);null!=t&&t.addComponent(n);for(let t of e.variableDeclarations.values())if(t.isReference)n.emplaceVariableReference(t.name);else{let e=null!=t.initializer?t.initializer.value:void 0;n.emplaceVariable(t.name,e)}return e.constraints.forEach((e=>function(e,t){let n=t.variableNames;if(null==n)throw Error("Constraint node must be type checked before it is used for building a constraint");let r=new Map,s=0;for(let e of n)r.set(e,s++);let a=t.methods.map((e=>{return t=e,n=r,new i.default(n.size,t.ins.map((e=>n.get(e.value.parameterName.value))),t.outs.map((e=>n.get(e.value.parameterName.value))),t.promiseMask,t.code.value,(null===(s=t.name)||void 0===s?void 0:s.value)||"");var t,n,s})),u=Array.from(r.keys(),(t=>e.getVariableReference(t))),l=new o.default(a),c=null!=t.name?t.name.value:null;return e.emplaceConstraint(c,l,u,!1)}(n,e))),e.components.forEach((e=>q(e,n))),n}},894:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(775),s=(u(n(916)),u(n(98)),u(n(831))),o=u(n(927)),i=u(n(779)),a=n(292);function u(e){return e&&e.__esModule?e:{default:e}}class l{constructor(e){this._owner=null,this._system=null,this._name=e,this._vars=new Set,this._varRefs=new Map,this._varRefNames=new Map,this._constraints=new Map,this._constraintNames=new Map,this._nextFreshCIndex=0,this._components=new Map}get edit(){const e=this;function t(t){const s=r(t)?t.substring(0,t.length-n.length):t,o=e.vs[s];if(null==o)throw`Unknown variable '${s}' in component '${e.name}'. Known variables: ${Array.from(e._varRefs.keys()).join(", ")}`;return o}const n="_self";function r(e){return e.endsWith(n)}return new Proxy({},{get(e,n,s){var o;if("symbol"==typeof n)throw"Dont know how to handle symbols, only strings";const i=t(n);return r(n)?i:null===(o=i.value)||void 0===o?void 0:o.value},set(n,r,s,i){if("symbol"==typeof r)throw"Dont know how to handle symbols, only strings";const u=t(r).value;if(null!=u)u.set(s);else{if(!((0,a.isVariable)(s)||s instanceof o.default))throw"Cannot set a dangling variable reference to the given value. It must be a Variable";e.vs[r]=s}return!0},ownKeys:function(t,n){return[...e._varRefs.keys()]},has:function(t,n){return n in e._varRefs.keys()},isExtensible:()=>!1})}clone(e=(0,a.freshComponentName)()){let t=new l(e),n=new Map;for(let[e,r]of this._varRefs)r.isOwningReference()?n.set(r,t.emplaceVariable(e)):n.set(r,t.emplaceVariableReference(e));for(let[e,r]of this._constraints){let s=r._varRefs.map((e=>n.get(e)));(0,a.isStay)(r)||t.emplaceConstraint(e,r._cspec,s,r._optional)}for(let[e,n]of this._components)t.addComponent(n.clone(e));return t}get system(){return this._system}get name(){return this._name}get owner(){return this._owner}connectSystem(e){return null!=this._owner?(r.hdconsole.error(`Tried to connect the nested component ${this._name}`),!1):this._system===e?(r.hdconsole.warn(`Same system connected twice to component ${this._name}`),!1):null!=this._system?(r.hdconsole.error(`Trying to connect an already connected component ${this._name} to a another system`),!1):e._componentNames.has(this.name)?(r.hdconsole.error(`There already exists a component with the name ${this._name} in the system`),!1):(e._componentNames.add(this.name),this._connectSystem(e),!0)}_connectSystem(e){this._system=e;for(let t of this._components.values())t._connectSystem(e);for(let t of this._constraints.values())0===t._danglingCount&&e.addConstraint(t)}disconnectSystem(){let e=this._system;return null==e?(r.hdconsole.error(`Tried to disconnect a component ${this._name} that is already disconnected`),!1):null!=this._owner?(r.hdconsole.error(`Tried to disconnect a subcomponent ${this._name} when owner is still connected`),!1):(e._componentNames.delete(this.name),this._disconnectSystem(),!0)}_disconnectSystem(){for(let e of this._components.values())e._disconnectSystem();for(let e of this._constraints.values())this._system.removeConstraint(e);this._system=null}addComponent(e){null==e._owner?null==e._system?this._components.has(e._name)?r.hdconsole.error(`Tried to add the component whose name ${e._name} already exists`):(e._owner=this,this._components.set(e._name,e),null!=this._system&&e.connectSystem(this._system)):r.hdconsole.error(`Tried to add to component ${this._name} the component ${e._name} that is connected to a system`):r.hdconsole.error(`Tried to add component ${e._name} that already has an owner to component ${this._name}`)}emplaceVariable(e,t){r.hdconsole.assert(!this._varRefs.has(e),`Trying to add variable ${e} twice to component ${this._name}`);let n=(0,a.mkVariable)(this,t);this._varRefs.set(e,n),this._varRefNames.set(n,e),this._vars.add(n.value);let s="__stay__"+e,o=new i.default(this,(0,a.stayConstraintSpec)(),[n],!0);return this._constraints.set(s,o),this._constraintNames.set(o,s),n}emplaceVariableReference(e){r.hdconsole.assert(!this._varRefs.has(e),`Trying to add variable reference ${e} twice to component ${this._name}`);let t=new s.default(this);return this._varRefs.set(e,t),this._varRefNames.set(t,e),t}emplaceConstraint(e,t,n,r=!1){let s=new i.default(this,t,n,r),o=null!=e?e:this._nextFreshConstraintName();if(this._constraints.has(o))throw`Constraint ${o} already exists in component ${this._name}`;return this._constraints.set(o,s),this._constraintNames.set(s,o),s}_nextFreshConstraintName(){return"c_"+this._nextFreshCIndex++}variableReferenceName(e){let t=this._varRefNames.get(e);return null==t?"<unnamed>":t}hasVariableReferenceName(e){return this._varRefNames.has(e)}constraintName(e){return this._constraintNames.get(e)}getVariableReference(e){let t=this._varRefs.get(e);return null!=t?t:null!=this._owner?this._owner.getVariableReference(e):void 0}get vs(){const e=this;function t(t){return e._varRefs.get(t)}return new Proxy({},{get:function(e,n){return t(n)},set:function(e,n,o){let i=t(n);return null==i?(r.hdconsole.warn(`Linking an unknown variable ${n}`),!1):(r.hdconsole.assert(o instanceof s.default,"Can only link value to an ObservableReference (i.e. a VariableReference)"),i.link(o),!0)}})}get cs(){const e=this;return new Proxy({},{get:function(t,n){return e._constraints.get(n)}})}get components(){const e=this;return new Proxy({},{get:function(t,n){return e._components.get(n)}})}}t.default=l},916:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(775),s=(o(n(137)),o(n(831)),n(268));function o(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(e){this._methods=new Set(e),r.hdconsole.assert(this._methods.size>0,"Constraint specification must have at least one method.");const t=(0,s.first)(this._methods);if(null==t)throw"Constraint specification must have at least one method.";const n=t.nvars;this._nvars=n,this._v2ins=[];for(let e=0;e<n;++e)this._v2ins.push([]);for(let e of this._methods){r.hdconsole.assert(e.nvars===n,"All methods in constraint specification must have the same number of variables");for(let t of e.outs())this._v2ins[t].push(e)}}get nvars(){return this._nvars}ins(e){return this._v2ins[e]}insSize(e){return this._v2ins[e].length}methods(){return this._methods}hasMethod(e){return this._methods.has(e)}prettyPrint(e,t){let n="";for(let r of this._methods)n+=e+r.prettyPrint(t)+"\n";return n}}},292:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.enforceStayMethod=function(e){e.selectedMethod=(0,a.first)(e._cspec._methods)},t.freshComponentName=void 0,t.freshNameGenerator=c,t.isConstraint=function(e){return e.hasOwnProperty("_cspec")},t.isMethod=function(e){return e.hasOwnProperty("_promiseMask")},t.isOwnerOf=function(e,t){let n=t;for(;e!==n;){if(null==n.owner)return!1;n=n.owner}return!0},t.isStay=function(e){const t=(0,a.first)(e._cspec._methods);return null!=t&&1===t.nvars&&"a => a"===t.code.toString()},t.isVariable=function(e){return e.hasOwnProperty("_activation")},t.maskUpdate=t.maskPromiseUpdate=t.maskPromise=t.maskNone=void 0,t.mkVariable=function(e,t){let n=new r.default(e);return n.value=new s.default(n,t),n},t.stayConstraintSpec=function(){return new i.default([new o.default(1,[0],[0],[0],(e=>e),"stay")])},t.toMask=function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return 0}},t.variableFromReference=function(e){let t=e.value;if(null==t)throw new Error(`Variable reference '${e.qualifiedName}' is dangling`);return u.hdconsole.assert(!t.stale,`Variable '${e.qualifiedName}' is stale`),t},l(n(894));var r=l(n(831)),s=l(n(927)),o=(l(n(779)),l(n(137))),i=l(n(916)),a=n(268),u=n(775);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){let t=0;return()=>e+t++}const h=c("comp_");t.freshComponentName=h,t.maskNone=0,t.maskPromise=1,t.maskUpdate=2,t.maskPromiseUpdate=3},98:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(17),s=n(329),o=n(775),i=h(n(894)),a=(h(n(137)),h(n(927)),n(391)),u=h(n(341)),l=n(292),c=n(268);function h(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(){this._optionals=new c.PriorityList,this._musts=new Set,this._dirty=new Set,this._v2cs=new c.OneToManyMap,this._usg=new a.UpstreamSolutionGraph(this),this._dsg=new a.DownstreamSolutionGraph(this),this._componentNames=new Set}get edit(){const e=this,t="_self";return new Proxy({},{get:(n,r,s)=>{if("symbol"==typeof r)throw`cannot access property by symbol ${String(r)}`;const o=r.endsWith(t);let i=o?r.substring(0,r.length-t.length):r;const a=e.componentByName(i);if(null==a)throw`Unknown component '${r.toString()}'. Known components: ${[...e.allComponents()].map((e=>e.name)).join(", ")}. Add suffix '_self' to a valid component name return the component`;return o?a:a.edit},set:(t,n,r,s)=>r instanceof i.default&&(e.addComponent(r),!0),ownKeys:function(t,n){return[...e.allComponents()].map((e=>e.name))},has:function(t,n){return n in[...e.allComponents()]}})}*allComponents(){const e=new Set;for(const t of this.allConstraints()){const n=t.owner;null==n||e.has(n)||(e.add(n),yield n)}}componentByName(e){for(let t of this.allComponents())if(t.name===e)return t;return null}allConstraints(){return(0,c.join)([this._musts,this._optionals.entries()])}addComponent(e){return e.connectSystem(this)}removeComponent(e){return e.system!==this?(console.warn(`Tried to remove component ${e._name} from a constraint system in which it does not exist.`),!1):e.disconnectSystem()}prettyPrint(){let e="-- musts --\n";for(let t of this._musts)e+=t.prettyPrint();e+="-- optionals --\n";for(let t of this._optionals.entries())e+=t.prettyPrint();return e}update(){this.plan(this.allConstraints()),this.solveFromConstraints(this.allConstraints())}updateDirty(){this.planDirty(),this.executeDirty(),this._dirty.clear()}variables(){return this._v2cs.keys()}constraints(e){return this._v2cs.values(e)}*allConstraints(){for(let e of this._musts)yield e;for(let e of this._optionals.entries())yield e}isMust(e){return this._musts.has(e)}isOptional(e){return!this._musts.has(e)}addConstraint(e){for(let t of e.variables())this._v2cs.add(t,e);e._optional?this._optionals.pushBack(e):this._musts.add(e),this._dirty.add(e)}removeConstraint(e){for(let t of e.variables())this._v2cs.remove(t,e),0===this._v2cs.count(t)&&this._v2cs.removeKey(t);e._optional?this._optionals.remove(e):this._musts.delete(e),this._dirty.delete(e)}setDirty(e){this._dirty.add(e)}gatherUpstreamConstraints(e){return(0,c.filter)((e=>(0,l.isConstraint)(e)),(0,r.reverseTopoSortFrom)(this._usg,e))}gatherDownstreamConstraints(e){return(0,c.filter)((e=>(0,l.isConstraint)(e)),(0,r.reverseTopoSortFrom)(this._dsg,e))}gatherDownstreamVariables(e){return(0,c.filter)((e=>(0,l.isVariable)(e)),(0,r.reverseTopoSortFrom)(this._dsg,e))}promoteVariable(e){this.promoteConstraint(this.getStay(e))}promoteConstraint(e){this._optionals.promote(e)}demoteConstraint(e){this._optionals.demote(e)}strength(e){return this.isMust(e)?this._optionals.highestPriority+1:this._optionals.priority(e)}getStay(e){for(let t of this._v2cs.values(e))if(t.name==="__stay__"+e.name)return t;return o.hdconsole.assert(!1,"Variable's stay constraint does not exists"),null}planDirty(){return this.plan(this._dirty)}plan(e){let t=(0,c.join)((0,c.map)((e=>e.variables()),e)),n=this.gatherUpstreamConstraints(t),r=new Set,s=new Set,o=new c.BinaryHeap(((e,t)=>this.strength(e)>this.strength(t))),i=new u.default;if((0,c.forEach)((e=>{e.clearSelectedMethod(),e._initPruningData(),this.isMust(e)?(r.add(e),i.addConstraint(e)):o.push(e)}),n),!i.plan())throw new Error("no plan for must constraints");for(;!o.empty();){let e=o.pop();switch(i.extendPlanIfPossible(e,s)){case!1:break;case!0:r.add(e),this._prune(e,r,s);break;case null:i.clear();for(let e of r)i.addConstraint(e);i.addConstraint(e),i.plan()?(r.add(e),this._prune(e,r,s)):(i.removeConstraint(e),e.clearSelectedMethod(),i.undoChangesAfterFailedPlan())}}return r}_prune(e,t,n){let r=new Set,s=Array.from(e._forcedVariables,(t=>e.i2v(t)));for(;s.length>0;){let e=s.pop();if(r.add(e),!n.has(e)){n.add(e);for(let n of this.constraints(e))if(n.isEnforced()&&t.has(n))for(let t of n._makeMethodsNonviableByVariable(e))r.has(t)||s.push(t)}}}solveFromConstraints(e){this.solve((0,c.join)((0,c.map)((e=>e.downstreamVariables()),e)))}solve(e){let t=[];for(let n of e){let e=this.getSourceConstraint(n);null!=e&&t.push(e)}let n=Array.from(this.gatherDownstreamConstraints(t)).reverse();for(let e of n)this.scheduleConstraint(e)}executeDirty(){let e=Array.from(this.gatherDownstreamConstraints(this._dirty)).reverse();for(let t of e)this.scheduleConstraint(t)}getSourceConstraint(e){for(let t of this._v2cs.values(e))if(t.isOutputVariable(e))return t;return null}scheduleConstraint(e){if(!e.isEnforced())return;let t=e.selectedMethod,n=Array.from(e.ins(t),(e=>e._activation)),r=[];(0,c.forEach)((e=>{r.push(e._activation),e.pushNewActivation()}),e.outs(t));let o=Array.from(e.outs(t),(e=>e._activation));new s.MethodActivation(t.code,t._promiseMask).execute(n,o),(0,c.forEach)((e=>(0,c.release)(e)),r)}scheduleCommand(e,t,n){let r=Array.from(e,(e=>e._activation)),o=Array.from(t),i=[];(0,c.forEach)((e=>{i.push(e._activation),e.pushNewActivation()}),o);let a=Array.from(o,(e=>e._activation));new s.MethodActivation(n,Array(r.length).fill(!1)).execute(r,a),(0,c.forEach)((e=>(0,c.release)(e)),i),o.forEach((e=>this.promoteVariable(e))),this.plan((0,c.map)((e=>this.getStay(e)),o)),this.solve(o)}}},779:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(775),s=(i(n(98)),i(n(916)),i(n(137)),i(n(831)),i(n(927)),n(292)),o=(i(n(894)),n(268));function i(e){return e&&e.__esModule?e:{default:e}}class a{prettyPrint(){let e="constraint "+this.name+" {\n";e+="  ";for(let t of this._varRefs)e+=t.prettyPrint()+"; ";return e+="\n",e+=this._cspec.prettyPrint("  ",this._varRefs),e+="}\n",e}substitute(e){return new a(this._owner,this._cspec,e,this._optional)}constructor(e,t,n,o=!1){this._owner=e,this._cspec=t,this._varRefs=[],this._vars=Array(t.nvars).fill(null),this._used=Array(t.nvars).fill(!0),this._danglingCount=t.nvars,this._optional=o,this._indices=new Map;let i=0;for(let e of n){r.hdconsole.assert((0,s.isOwnerOf)(e._owner,this._owner),`Constructing constraint ${this.name} with a foreign variable reference`),this._varRefs[i]=e;{let t=i;e.subscribe((e=>{if(null!==e){if(null!=this._vars[t]&&console.log("NOTNULL",this._vars[t]),this._vars[t]=e,this._indices.set(e,t),0==--this._danglingCount){let e=this.system;null!=e&&e.addConstraint(this)}}else{if(null===this._vars[t])return;if(0==this._danglingCount++){let e=this.system;null!=e&&e.removeConstraint(this)}this._indices.delete(this._vars[t]),this._vars[t]=null}}))}++i}this._initPruningData(),this.clearSelectedMethod()}equals(e){return this===e}get name(){return null==this._owner?"<unnamed>":this._owner.constraintName(this)}get owner(){return this._owner}get optional(){return this._optional}get nvars(){return this._cspec.nvars}get system(){return this._owner.system}i2v(e){return this._vars[e]}v2i(e){return r.hdconsole.assert(this._indices.has(e),"unknown variable in Constraint.v2i: "+e.name),this._indices.get(e)}variables(){return this._vars}outs(e){return e.vOuts(this._vars)}ins(e){return e.vIns(this._vars)}nonOuts(e){return e.vNonOuts(this._vars)}methods(){return this._cspec.methods()}hasMethod(e){return this._cspec.hasMethod(e)}viableMethods(){return this._viableMethods}get selectedMethod(){return this._selectedMethod}set selectedMethod(e){r.hdconsole.assert(this._cspec.hasMethod(e),"selecting a method not in the constraint"),this._selectedMethod=e;for(let t of e.ins())this._used[t]=!0}clearSelectedMethod(){this._selectedMethod=null}isEnforced(){return null!=this._selectedMethod}isOutputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isOut(this.v2i(e))}isInputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isIn(this.v2i(e))}isNonOutputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isNonOut(this.v2i(e))}downstreamVariables(){return null==this.selectedMethod?(0,o.mkEmptyIterable)():this.selectedMethod.vOuts(this._vars)}downstreamAndUndetermined(){return null==this.selectedMethod?this._vars:this.selectedMethod.vOuts(this._vars)}upstreamVariables(){return null==this.selectedMethod?(0,o.mkEmptyIterable)():this.selectedMethod.vNonOuts(this._vars)}upstreamAndUndetermined(){return null==this.selectedMethod?this._vars:this.selectedMethod.vNonOuts(this._vars)}_initPruningData(){this._viableMethods=new Set,this._forcedVariables=new Set,this._outCounts=Array(this.nvars).fill(0);for(let e of this.methods()){this._viableMethods.add(e);for(let t of e.outs())this._outCounts[t]+=1}const e=this._viableMethods.size;for(let t=0;t<this.nvars;++t)this._outCounts[t]===e&&this._forcedVariables.add(t)}_makeMethodViable(e){r.hdconsole.assert(!this._viableMethods.has(e),"making a method viable twice"),r.hdconsole.assert(this.hasMethod(e),"unknown method");let t=this._viableMethods.size;this._viableMethods.add(e);let n=[];for(let t of e.outs())this._outCounts[t]+=1;for(let r of e.nonOuts())this._outCounts[r]===t&&(this._forcedVariables.delete(r),n.push(r));return n}_makeMethodNonviable(e){r.hdconsole.assert(this._viableMethods.has(e),"making a method nonviable twice"),r.hdconsole.assert(this._viableMethods.size>=2,"trying to make the last viable method nonviable"),this._viableMethods.delete(e);let t=this._viableMethods.size,n=[];for(let t of e.outs())this._outCounts[t]-=1;for(let r of e.nonOuts())this._outCounts[r]===t&&(this._forcedVariables.add(r),n.push(r));for(let e=0;e<this._outCounts.length;++e)r.hdconsole.assert(this._outCounts[e]>=0);return n}_makeMethodsNonviableByVariable(e){let t=this.v2i(e);if(this._forcedVariables.has(t))return(0,o.mkEmptyIterable)();let n=new Set;for(let e of(0,o.filter)((e=>e.isOut(t)),this._viableMethods))for(let t of(0,o.map)((e=>this.i2v(e)),this._makeMethodNonviable(e)))n.add(t);return n}}t.default=a},137:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(775),s=n(268);t.default=class{constructor(e,t,n,s,o,i){this._ins=new Set(t),this._outs=new Set(n);let a=Array.from(Array(e).keys());this._outs.forEach((e=>a[e]=null)),this._nonOuts=new Set;for(let e of a)null!=e&&this._nonOuts.add(e);this._promiseMask=Array.from(s),r.hdconsole.assert(this._ins.size===this._promiseMask.length,"Number of input arguments and length of promise mask must be the same"),this.code=o,null!=i&&(this._name=i)}get name(){return null==this._name?"":this._name}get nvars(){return this._outs.size+this._nonOuts.size}validIndex(e){return e>=0&&e<this.nvars}ins(){return this._ins}outs(){return this._outs}nonOuts(){return this._nonOuts}vIns(e){return(0,s.map)((t=>e[t]),this._ins)}vOuts(e){return(0,s.map)((t=>e[t]),this._outs)}vNonOuts(e){return(0,s.map)((t=>e[t]),this._nonOuts)}nIns(){return this._ins.size}nOuts(){return this._outs.size}nNonOuts(){return this._nonOuts.size}isIn(e){return this._ins.has(e)}isOut(e){return this._outs.has(e)}isNonOut(e){return this._nonOuts.has(e)}prettyPrint(e){let t=this.name+"(";for(const n of this._nonOuts)t+=e[n].name+" ";t+="->";for(const n of this._outs)t+=" "+e[n].name;return t+=");",t}}},986:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.componentFromJson=componentFromJson,exports.componentToJson=componentToJson,exports.constraintFromJson=constraintFromJson,exports.constraintSpecFromJson=constraintSpecFromJson,exports.constraintSpecToJson=constraintSpecToJson,exports.constraintSystemFromJson=constraintSystemFromJson,exports.constraintSystemToJson=constraintSystemToJson,exports.constraintToJson=constraintToJson,exports.methodFromJson=methodFromJson,exports.methodToJson=methodToJson,exports.variableReferenceToJson=variableReferenceToJson;var _method=_interopRequireDefault(__webpack_require__(137)),_component=_interopRequireDefault(__webpack_require__(894)),_constraintSpec=_interopRequireDefault(__webpack_require__(916)),_constraint=_interopRequireDefault(__webpack_require__(779)),_constraintSystem=_interopRequireDefault(__webpack_require__(98)),_constraintSystemUtil=__webpack_require__(292),_variableReference=_interopRequireDefault(__webpack_require__(831));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function variableReferenceToJson(e){var t,n,r;return{owner:null!==(t=null===(n=e.value)||void 0===n?void 0:n.owner.owner.name)&&void 0!==t?t:e.owner.name,name:e.name,value:null===(r=e.value)||void 0===r?void 0:r.value}}function methodToJson(e){var t;return{name:e._name,nvars:e.nvars,ins:Array.from(e._ins),outs:Array.from(e._outs),code:null===(t=e.code)||void 0===t?void 0:t.toString(),promiseMask:Array.from(e._promiseMask)}}function methodFromJson(method){return new _method.default(method.nvars,method.ins,method.outs,method.promiseMask.map(_constraintSystemUtil.toMask),eval(`let f = ${method.code}; f`),method.name)}function constraintSpecToJson(e){return{methods:Array.from(e._methods).map(methodToJson)}}function constraintSpecFromJson(e){return new _constraintSpec.default(e.methods.map(methodFromJson))}function componentToJson(e,t){return{name:e.name,variables:Array.from(e._varRefs.values()).map((e=>variableReferenceToJson(e))),constraints:t}}function componentFromJson(e){let t=new _component.default(e.name),n=[];return e.variables.forEach((r=>{if(r.owner===e.name)t.emplaceVariable(r.name,r.value);else{let e=t.emplaceVariableReference(r.name);n.push((()=>{var n,s,o;e.value=null===(n=t.system)||void 0===n||null===(s=n.componentByName(r.owner))||void 0===s||null===(o=s.getVariableReference(r.name))||void 0===o?void 0:o.value}))}})),e.constraints.forEach((e=>{constraintFromJson(e,t)})),[t,n]}function constraintToJson(e,t){return{name:t,constraintSpec:constraintSpecToJson(e._cspec),optional:e._optional}}function constraintFromJson(e,t){return t.emplaceConstraint(e.name,constraintSpecFromJson(e.constraintSpec),t._varRefs.values(),e.optional)}function constraintSystemToJson(e){let t=new Map;for(const n of e.allComponents())t.set(n,[...n._constraints.values()].filter((e=>!e.optional)));const n={components:Array.from(t.keys()).map((e=>{var n;const r=(null!==(n=t.get(e))&&void 0!==n?n:[]).map((t=>{var n;return constraintToJson(t,null!==(n=e.constraintName(t))&&void 0!==n?n:"")}));return componentToJson(e,r)}))};return JSON.stringify(n)}function constraintSystemFromJson(e){const t=JSON.parse(e),n=new _constraintSystem.default,r=[];return t.components.forEach((e=>{let[t,s]=componentFromJson(e);n.addComponent(t),r.push(...s)})),r.forEach((e=>e())),n}},341:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(n(927)),o(n(779)),o(n(137));var r=n(775),s=n(268);function o(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(){this._v2cs=new s.OneToManyMap,this._freeVars=new Set,this._forcedByPlan=new Map,this._changeList=[]}addConstraint(e){for(let t of e.variables())switch(this._v2cs.add(t,e),this._v2cs.count(t)){case 1:this._freeVars.add(t);break;case 2:this._freeVars.delete(t)}}removeConstraint(e){for(let t of e.variables())switch(this._v2cs.remove(t,e),this._v2cs.count(t)){case 0:this._freeVars.delete(t),this._v2cs.removeKey(t);break;case 1:this._freeVars.add(t)}}clear(){this._v2cs.clear(),this._freeVars.clear()}plan(){let e=!0;for(;e;){e=!1;for(let[t,n]of this.freeMethods()){e=!0;let r=t.selectedMethod;if(r!==n&&null!=r){this._changeList.push([t,r]);for(let e of t.outs(r))this._forcedByPlan.delete(e)}t.selectedMethod=n;for(let e of t.outs(n))this._forcedByPlan.set(e,n);this.removeConstraint(t)}}return 0===this._v2cs.countKeys()&&(this._changeList=[],!0)}undoChangesAfterFailedPlan(){for(let[e,t]of this._changeList){let n=e.selectedMethod;if(null!=n)for(let t of e.outs(n))this._forcedByPlan.delete(t);for(let n of e.outs(t))this._forcedByPlan.set(n,t);e.selectedMethod=t}}extendPlanIfPossible(e,t){if((0,s.every)((n=>(0,s.some)((e=>t.has(e)),e.outs(n))),e._viableMethods))return!1;if((0,s.every)((e=>!this._forcedByPlan.has(e)),e.variables())){let t=(0,s.first)(e._viableMethods);if(r.hdconsole.assert(null!=t,"constraint has no viable methods"),null==t)return!1;e.selectedMethod=t;for(let n of e.outs(t))this._forcedByPlan.set(n,t);return!0}return null}*freeMethods(){let e=new Set;for(let t of this._freeVars)for(let n of this._v2cs.values(t))if(!e.has(n)){e.add(n);for(let e of n.viableMethods())if((0,s.every)((e=>this._freeVars.has(e)),n.outs(e))){yield[n,e];break}}}firstFreeMethod(){return(0,s.first)(this.freeMethods())}constraints(){let e=new Set;for(let t of this._v2cs.keys())for(let n of this._v2cs.values(t))e.add(n);return e}}},391:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamSolutionGraph=t.DownstreamSolutionGraph=void 0,o(n(779)),o(n(927)),o(n(98));var r=n(292),s=n(268);function o(e){return e&&e.__esModule?e:{default:e}}t.DownstreamSolutionGraph=class{constructor(e){this._system=e}adjacentOutVertices(e){return(0,r.isConstraint)(e)?e.downstreamAndUndetermined():(0,s.filter)((t=>t.isNonOutputVariable(e)||!t.isEnforced()),this._system._v2cs.values(e))}outDegree(e){return(0,r.isConstraint)(e)?null!=e.selectedMethod?e.selectedMethod.nOuts():0:(0,s.count)(this.adjacentOutVertices(e))}},t.UpstreamSolutionGraph=class{constructor(e){this._system=e}adjacentOutVertices(e){return(0,r.isConstraint)(e)?e.upstreamAndUndetermined():(0,s.filter)((t=>t.isOutputVariable(e)||!t.isEnforced()),this._system._v2cs.values(e))}outDegree(e){return(0,r.isConstraint)(e)?null!=e.selectedMethod?e.selectedMethod.nNonOuts():0:(0,s.count)(this.adjacentOutVertices(e))}}},831:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(268);function s(e){return e&&e.__esModule?e:{default:e}}s(n(894)),s(n(98)),s(n(927));class o extends r.ObservableReference{constructor(e){super(),this._owner=e}get system(){return this._owner.system}get name(){return this._owner.variableReferenceName(this)}get owner(){return this._owner}get owningReference(){var e;return null===(e=this.value)||void 0===e?void 0:e._owner}get qualifiedName(){return`${this.owner.name}.${this.name}`}isOwningReference(){return null!=this.value&&this.value._owner===this}prettyPrint(){let e=this.name;return null!=this.value&&(e+=":"+this.value._index),e}}t.default=o},927:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(329),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=a(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(534)),o=(i(n(831)),i(n(98)),n(268));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(a=function(e){return e?n:t})(e)}let u=(()=>{let e=0;return()=>++e})();t.default=class{get value(){return this._inError?void 0:this._value}get error(){return this._inError?this._error:void 0}get stale(){return!this._pending&&this._inError}get pending(){return this._pending}constructor(e,t){this._index=u(),this._owner=e,this._value=void 0,this._error=void 0,this._inError=!1,this._pending=!0,this._subject=new s.Subject((e=>{let t={value:!1===this._pending?this._value:void 0,pending:this._pending,inError:this._inError};this._inError&&(t.error=this._error),e.next(t)})),this.pushNewActivation(),void 0!==t&&(this._activation.resolve(t),this._value=t)}subscribe(e){return this._subject.subscribe(e)}subscribeValue(e){return this._subject.filter((e=>e.hasOwnProperty("value"))).map((e=>e.value)).subscribe(e)}subscribePending(e){return this._subject.filter((e=>e.hasOwnProperty("pending"))).map((e=>e.pending)).subscribe(e)}subscribeError(e){return this._subject.filter((e=>e.hasOwnProperty("inError")||e.hasOwnProperty("error"))).map((e=>{let t={};return e.hasOwnProperty("error")&&(t.error=e.error),e.hasOwnProperty("inError")&&(t.inError=e.inError),t})).subscribe(e)}pushNewActivation(){let e=new r.VariableActivation(this);return this._activation=e,!1===this._pending&&(this._pending=!0,this._subject.sendNext({pending:!0})),this.system,this.owner,e.promise.then((t=>{if(e===this._activation){this._value=t;let e={value:t};this._inError&&(this._inError=!1,e.inError=!1),this._pending=!1,e.pending=!1,this._subject.sendNext(e)}}),(t=>{if(e===this._activation){this._error=t;let e={error:t};this._inError||(this._inError=!0,e.inError=!0),this._pending=!1,e.pending=!1,this._subject.sendNext(e)}})),e}get currentPromise(){return this._activation.promise}get owner(){return this._owner}get system(){return this._owner.system}get name(){return null==this._owner?"<unnamed>":this._owner.name}set(e){this.assign(e);let t=this.system;return null!=t&&t.updateDirty(),this}fail(e){this._assign().reject(e);let t=this.system;return null!=t&&t.updateDirty(),this}assign(e){this._assign().resolve(e)}_assign(){let e=this._activation;this.pushNewActivation();let t=this.system;if(null!=t){t.promoteVariable(this);let e=t.getSourceConstraint(this);null!=e&&t.setDirty(e),t.setDirty(t.getStay(this))}return(0,o.release)(e),this._activation}touch(){let e=this.system;return null!=e&&e.promoteVariable(this),this}_touchPlanSolve(){this.touch();let e=this.system,t=this._activation;if(this.pushNewActivation(),null==e)return(0,o.release)(t),this._activation;let n=this._activation,r=e.getSourceConstraint(this);return e.setDirty(null!=r?r:e.getStay(this)),e.updateDirty(),(0,o.release)(t),n}}},17:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dfsVisit=s,t.reverseTopoSort=function(e){return i(e,e.vertices())},t.reverseTopoSortFrom=i;var r=n(268);function s(e,t,n,s=new Set){let o=[],i=(0,r.iterableToIterator)(t);for(;;){let t=i.next();if(t.done){if(0===o.length)break;let e;[e,i]=o.pop(),n.finishVertex(e);continue}let a=t.value;s.has(a)||(n.discoverVertex(a),s.add(a),o.push([a,i]),i=(0,r.iterableToIterator)(e.adjacentOutVertices(a)))}}class o{constructor(){this.result=[]}discoverVertex(e){}finishVertex(e){this.result.push(e)}}function i(e,t){let n=new o;return s(e,t,n),n.result}},775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hdconsole=t.default=t.HdError=t.HdConsole=void 0;class n{constructor(e){this._name=e,"object"==typeof jest?this.off():this.on()}off(){this.log=(...e)=>{},this.warn=(...e)=>{},this.error=(...e)=>{},this.assert=(e,...t)=>{}}errorsOnly(){this.off(),this.error=console.error,this.assert=console.assert}on(){this.log=console.log,this.warn=console.warn,this.error=console.error,this.assert=console.assert}}t.HdConsole=n;const r=new n("HotDrink");t.hdconsole=r;var s={hdconsole:r};t.default=s;class o extends Error{constructor(e,...t){super(e,...t),Error.captureStackTrace&&Error.captureStackTrace(this,o),this.name="HdError"}}t.HdError=o},707:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0});var r={defaultConstraintSystem:!0,constraintSystemInVisNodesAndEdges:!0,constraintSystemInVisAllNodesAndEdges:!0,ConstraintSystem:!0,Method:!0,component:!0,hdl:!0,hdconsole:!0,maskPromiseUpdate:!0,maskUpdate:!0,maskPromise:!0,maskNone:!0,MaskType:!0,Component:!0,Constraint:!0,ConstraintSpec:!0,Variable:!0,VariableReference:!0,SimplePlanner:!0};Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"Constraint",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"ConstraintSpec",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"ConstraintSystem",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"MaskType",{enumerable:!0,get:function(){return l.MaskType}}),Object.defineProperty(t,"Method",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"SimplePlanner",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(t,"Variable",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"VariableReference",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"component",{enumerable:!0,get:function(){return i.component}}),t.constraintSystemInVisAllNodesAndEdges=function(e){let t=[],n=[];for(let n of e.variables())t.push({id:w(n),label:n.name,shape:"box"});for(let r of e.allConstraints()){let e=0;for(let s of r.methods()){let o=`m#${w(r)}-${e}`;console.log("ID: ",o,"C.M",r.name+"."+s.name);let i="lime";t.push({id:o,label:r.name+"."+s.name,cid:"C#"+w(r),color:i});for(let e of r.nonOuts(s))n.push({from:w(e),to:o,arrows:"to",dashes:!0}),console.log("INS: ",e.name);for(let e of r.outs(s))n.push({from:o,to:w(e),arrows:"to"}),console.log("OUTS: ",e.name);++e}}return[t,n]},t.constraintSystemInVisNodesAndEdges=function(e){let t=[],n=[];for(let n of e.variables())t.push({id:w(n),label:n.name,shape:"box"});for(let r of e.allConstraints()){let e=0;if(!r.isEnforced())continue;let s=r.selectedMethod,o=`m#${w(r)}-${e}`;console.log("ID: ",o,"C.M",r.name+"."+s.name);let i="lime";t.push({id:o,label:r.name+"."+s.name,cid:"C#"+w(r),color:i});for(let e of r.nonOuts(s))n.push({from:w(e),to:o,arrows:"to",dashes:!0});for(let e of r.outs(s))n.push({from:o,to:w(e),arrows:"to"});++e}return[t,n]},t.defaultConstraintSystem=void 0,Object.defineProperty(t,"hdconsole",{enumerable:!0,get:function(){return a.hdconsole}}),Object.defineProperty(t,"hdl",{enumerable:!0,get:function(){return i.hdl}}),Object.defineProperty(t,"maskNone",{enumerable:!0,get:function(){return l.maskNone}}),Object.defineProperty(t,"maskPromise",{enumerable:!0,get:function(){return l.maskPromise}}),Object.defineProperty(t,"maskPromiseUpdate",{enumerable:!0,get:function(){return l.maskPromiseUpdate}}),Object.defineProperty(t,"maskUpdate",{enumerable:!0,get:function(){return l.maskUpdate}});var s=y(n(98)),o=y(n(137)),i=n(230),a=n(775),u=n(391);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var l=n(292);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=n(986);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var h=y(n(894)),f=y(n(779)),d=y(n(916)),p=y(n(927)),_=y(n(831)),m=y(n(341)),v=n(84);Object.keys(v).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===v[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}}))}));var b=n(673);function y(e){return e&&e.__esModule?e:{default:e}}Object.keys(b).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===b[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}}))}));const g=new s.default;t.defaultConstraintSystem=g;let w=(()=>{let e=new WeakMap,t=0;return n=>{let r=e.get(n);if(void 0!==r)return r;{let r=t++;return e.set(n,r),r}}})()},877:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Position=void 0,t.isAlpha=s,t.isAlphaNum=function(e){return o(e)||r(e)},t.isAlphaPlus=o,t.isDigit=r,t.isWhitespace=function(e){switch(e){case" ":case"\t":case"\r":case"\n":return!0;default:return!1}};class n{constructor(e,t,n,r){this._pos=e,this._row=t,this._col=n,void 0!==r&&(this._source=r)}get pos(){return this._pos}get row(){return this._row}get col(){return this._col}get source(){return null!=this._source?this._source:"-"}toString(){return this.source+":"+this.row+":"+this.col}advance(e){for(let t=0;t<e.length;++t)"\n"===e[t]?(this._row++,this._col=0):this._col++,this._pos++}clone(){let e=new n(this.pos,this.row,this.col);return this.hasOwnProperty("_source")&&(e._source=this._source),e}}function r(e){return e>="0"&&e<="9"}function s(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function o(e){return s(e)||"_"===e||"$"===e}t.Position=n},534:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionObserver=t.Subject=t.SimpleSubscription=t.ReplaySubject=t.Observable=t.HdSubscription=t.BehaviorSubject=void 0,t.mkObserver=a;var r=n(775);function s(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function o(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,i(e,t,"get"))}function i(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function a(e,t,n){if("function"==typeof e){let r={};return r.next=e,null!=t&&(r.error=t),null!=n&&(r.complete=n),r}return e}class u{constructor(e){this._subscriber=e}subscribe(e,t,n){let r=a(e,t,n),s=new f(r);try{null!=r.start&&r.start(s)}catch(e){}if(s.closed)return s;let o=new d(s);try{let e=this._subscriber(o);"object"==typeof e&&(e=()=>e.unsubscribe()),s._cleanup=e}catch(e){o.error(e)}return s.closed&&s.cleanup(),s}static of(...e){return new u((t=>{for(let n of e)if(t.next(n),t.closed)return;t.complete()}))}filter(e){return new u((t=>{let n=a(t);return null==n.next&&(n={next:e=>{}}),this.subscribe((t=>{!0===e(t)&&n.next(t)}))}))}map(e){return new u((t=>{let n=a(t);return null==n.next&&(n={next:e=>{}}),this.subscribe((n=>{a(t).next(e(n))}))}))}}t.Observable=u;var l=new WeakMap,c=new WeakMap;class h{constructor(e=(()=>{})){var t,n;s(this,l,{writable:!0,value:[]}),s(this,c,{writable:!0,value:void 0}),n=e,function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(t=this,i(t,c,"set"),n)}get closed(){return!1}get additionalSubscriptions(){return o(this,l)}unsubscribe(){o(this,c).call(this);for(let e of o(this,l))e.unsubscribe()}}t.SimpleSubscription=h;class f extends h{constructor(e){super(),this._observer=e,this._cleanup=void 0}unsubscribe(){this.cleanup(),this._observer=void 0,super.unsubscribe()}get closed(){return void 0===this._observer}cleanup(){const e=this._cleanup;if(void 0!==e){this._cleanup=void 0;try{e()}catch(e){}}}}t.HdSubscription=f;class d{constructor(e){this._subscription=e}get closed(){return this._subscription.closed}next(e){let t=this._subscription;if(!t.closed&&null!=t._observer.next)try{t._observer.next(e)}catch(e){r.hdconsole.error("Exception thrown on subscription next:",e)}}error(e){let t=this._subscription;if(!t.closed){if(null!=t._observer.error)try{t._observer.error(e)}catch(e){r.hdconsole.error("Exception thrown on subscription error: ",e)}this._subscription.cleanup()}}complete(){let e=this._subscription;if(!e.closed){if(null!=e._observer.complete)try{e._observer.complete()}catch(e){r.hdconsole.error("Exception thrown on subscription complete: ",e)}this._subscription.cleanup()}}}t.SubscriptionObserver=d;class p extends u{constructor(e=(e=>{})){let t={observers:new Set,done:!1};super((n=>(t.done||t.observers.add(n),e(n),()=>t.observers.delete(n)))),this._subjectState=t}sendNext(e){if(!this._subjectState.done)for(const t of this._subjectState.observers)t.next(e)}sendError(e){if(!this._subjectState.done){this._subjectState.done=!0;for(const t of this._subjectState.observers)t.error(e)}}sendComplete(){if(!this._subjectState.done){this._subjectState.done=!0;for(const e of this._subjectState.observers)e.complete()}}get nObservers(){return this._subjectState.observers.size}}t.Subject=p;class _ extends p{constructor(e=1){let t={past:[],pastLimit:e,isCompleted:!1,isError:!1};super((e=>{for(let n of t.past)e.next(n);t.isError?e.error(t.error):t.isCompleted&&e.complete()})),this._replaySubjectState=t}sendNext(e){this._replaySubjectState.past.push(e),this._replaySubjectState.past.length>this._replaySubjectState.pastLimit&&this._replaySubjectState.past.shift(),super.sendNext(e)}sendError(e){this._replaySubjectState.isError=!0,this._replaySubjectState.error=e,super.sendError(e)}sendComplete(){this._replaySubjectState.isCompleted=!0,super.sendComplete()}}t.ReplaySubject=_,t.BehaviorSubject=class extends _{constructor(e){super(1),this._replaySubjectState.past.push(e)}}},316:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.blockComment=t.alphaPlus=t.alphaNum=t.ParseState=t.ParseError=void 0,t.context=function(e,t){return n=>{n.pushContext(e);try{return t(n)}finally{n.popContext()}}},t.digit=t.currentPos=void 0,t.eof=b,t.exactString=O,t.fail=f,t.failF=d,t.failure=function(e){return f([])},t.go=A,t.hdl=function(e,...t){let n="";for(let r=0;r<t.length;++r)n+=e[r],n+="###"+r+"###";return e.length>0&&(n+=e[e.length-1]),c(n,t)},t.identifier=function(e){return R(((e,t,n)=>e+t.join("")),y(s.isAlphaPlus,"<identifier>"),M(y(s.isAlphaNum)),E)(e)},t.ignore=function(e){return R((()=>T),e)},t.inBetween=D,t.item=_,t.keyword=function(e){return J(B(I(O(e),J(k,"<alphanum>"))),`<keyword: ${e}>`)},t.lift=R,t.lift2=function(e){return(t,n)=>R(e,t,n)},t.lift3=function(e){return(t,n,r)=>R(e,t,n,r)},t.lift4=function(e){return(t,n,r,s)=>R(e,t,n,r,s)},t.lift5=function(e){return(t,n,r,s,o)=>R(e,t,n,r,s,o)},t.lineComment=void 0,t.many=M,t.many1=x,t.manyws=void 0,t.mkParseState=c,t.must=function(e,t){return n=>{let r=e(n);if(r.success)return r;throw n.parseErrorF(r.expecting,t)}},t.named=J,t.nat=void 0,t.notFollowedBy=I,t.ok=h,t.oneOf=F,t.onews=void 0,t.opt=function(e,t){return n=>{n.checkpoint();let r=e(n);return r.success?(n.forgetCheckpoint(),h(r.value,r.consumed)):(n.resetCheckpoint(),h(t,!1))}},t.pBind=N,t.pBind_=V,t.pChar=g,t.pChars=function(e){return y((t=>(0,i.some)((e=>e===t),e)),`<any of '${e}'>`)},t.pExactStrings=function(e){let t=F(...e.map((e=>O(e))));return t.parserName=e.join(),t},t.pNot=z,t.pSplice=void 0,t.pTry=$,t.pTryUnnamed=function(e,t){return $(J(e,t))},t.parens=function(e){return D(e,q("("),q(")"))},t.peekItem=m,t.ret=v,t.sat=y,t.sepList=function(e,t){return n=>{let r=e(n);if(!r.success)return r.consumed?r:h([],!1);let s=M(V(t,e))(n);return s.consumed=r.consumed||s.consumed,s.success&&s.value.unshift(r.value),s}},t.token=B,t.until=function(e){return R((e=>e.join("")),M(V(z(e),_)))},t.word=q;var r,s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,n&&n.set(e,r),r}(n(877)),o=(r=n(738))&&r.__esModule?r:{default:r},i=n(268),a=n(775);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}class l{constructor(e,t=[],n=new s.Position(0,1,0)){this._input=new o.default(e),this._context=[],this._splices=t,this.pos=n}pushContext(e){this._context.push([e,this.pos.clone()])}popContext(){this._context.pop()}checkpoint(){this._input.checkpoint(this.pos.clone())}forgetCheckpoint(){this._input.forgetCheckpoint()}resetCheckpoint(){this.pos=this._input.reset()}peek(){return this._input.peek()}advance(){let e=this._input.next();return e.done||this.pos.advance(e.value),e.value}getSplice(e){return this._splices[e]}parseErrorF(e,t){let n,r;this._context.length>0&&([n,r]=this._context[this._context.length-1]),this.checkpoint();let o=R(((e,t)=>e+t.join("")),E,M(y((e=>!s.isWhitespace(e)),"")))(this);this.resetCheckpoint();let i="<?>";return o.success&&(i=o.value),new p(this.pos.clone(),e,i,n,r,t)}parseError(e,t){return this.parseErrorF((()=>e),t)}}function c(e,t=[]){return new l(e[Symbol.iterator](),t)}function h(e,t=!0){return{success:!0,value:e,consumed:t}}function f(e,t=!1){return d((()=>e),t)}function d(e,t=!1){return{success:!1,expecting:e,consumed:t}}t.ParseState=l;class p extends Error{constructor(e,t,n,r,s,o){super(),this._pos=e,this._expecting=t,this._unexpected=n,this._ctxName=r,this._ctxPos=s,this._msg=o}get name(){return"HotDrink Parse Error"}set name(e){throw Error("Cannot set the name of ParseError")}get message(){let e=this._pos.toString()+"\n";null!=this._msg&&(e+=this._msg+"\n");let t=this._formatExpecting();return""!==t&&(e+="Expecting "+t+". "),e+="Unexpected "+(null!=this._unexpected?this._unexpected:"<eof>")+"\n",null!=this._ctxName&&null!=this._ctxPos&&(e+="\n  while parsing "+this._ctxName+" ("+this._ctxPos.toString()+")\n"),e}set message(e){throw Error("Cannot set the message of ParseError")}_formatExpecting(){let e=this._expecting();return 1===e.length?e[0]:e.length>1?"one of ("+e.join(", ")+")":""}}function _(e){let t=e.advance();return null==t?f(["<item>"]):h(t)}function m(e){let t=e.peek();return null==t?f(["<peek-item>"]):h(t,!1)}function v(e,t=!1){return n=>h(e,t)}function b(e){return m(e).success?f(["<eof>"]):h(null,!1)}function y(e,t="<sat: ?>"){let n=n=>{let r=m(n);return r.success&&e(r.value)?_(n):f([t])};return n.parserName=t,n}function g(e){return y((t=>t===e),e)}t.ParseError=p;const w=y(s.isAlphaPlus,"<letter>");t.alphaPlus=w;const k=y(s.isAlphaNum,"<letter or digit>");t.alphaNum=k;const S=y(s.isDigit,"<digit>");function M(e){return F(x(e),v([]))}function x(e){return t=>R(((e,t)=>(t.unshift(e),t)),e,M(e))(t)}function O(e){let t=t=>{t.checkpoint();for(let n of e){let r=_(t);if(r.success&&r.value!==n||!r.success)return t.resetCheckpoint(),f([e])}return t.forgetCheckpoint(),h(e,e.length>0)};return t.parserName=e,t}t.digit=S;const P=R(((e,t,n)=>e+t.join("")+n),O("//"),M(y((e=>"\n"!==e))),F(g("\n"),V(b,v(""))));t.lineComment=P;const C=R(((e,t,n)=>e+t.join("")+n),O("/*"),M(V(z(O("*/")),_)),F(O("*/"),V(b,v(""))));t.blockComment=C;const j=y(s.isWhitespace,"<whitespace>");t.onews=j;const E=R((e=>e.join("")),M(F(j,P,C)));function N(e,t){return n=>{const r=e(n);if(!r.success)return r;let s=t(r.value)(n);return s.consumed||(s.consumed=r.consumed),s}}function V(e,t){return N(e,(e=>t))}t.manyws=E;const T={};function R(e,...t){return n=>{let r=[],s=!1;for(let e of t){let t=e(n);if(t.consumed=t.consumed||s,s=t.consumed,!t.success)return t;t.value!==T&&r.push(t.value)}return h(e(...r))}}function A(e){return function(t){let n=!1,r=e.next();for(;!r.done;){let s=r.value(t);if(s.consumed=s.consumed||n,n=s.consumed,!s.success)return s;r=e.next(s.value)}return void 0===r.value?(a.hdconsole.assert(!1,"Incorrect yield parser"),f(["<?>"],n)):h(r.value,n)}}function D(e,t,n){return A(function*(){yield t;const r=yield e;return yield n,r}())}function F(...e){return t=>{let n=[];for(let r of e){let e=r(t);if(e.success||e.consumed)return e;n.push(e.expecting)}return d((()=>Array.prototype.concat(...n.map((e=>e())))))}}function z(e){return t=>{t.checkpoint();let n=e(t);if(!n.success&&!n.consumed)return t.resetCheckpoint(),h(null,!1);let r=n.consumed;return n.success?(t.resetCheckpoint(),r=!1):t.forgetCheckpoint(),f(["not("+e.parserName+")"],r)}}function I(e,t){return n=>{n.checkpoint();let r=e(n);if(!r.success)return n.forgetCheckpoint(),r;let s=z(t)(n);return s.success?(n.forgetCheckpoint(),r):s.consumed?(n.forgetCheckpoint(),s):(n.resetCheckpoint(),f([e.parserName+" not followed by "+t.parserName]))}}function $(e){return t=>{t.checkpoint();let n=e(t);return n.success?(t.forgetCheckpoint(),n):(t.resetCheckpoint(),f([e.parserName]))}}function J(e,t="<?>"){let n=n=>{let r=e(n);return r.success||(r.expecting=()=>[t]),r};return n.parserName=t,n}function B(e){return R(((e,t)=>e),e,E)}function q(e){return B(O(e))}let L=R((e=>Number(e.join(""))),J(B(I(J(x(S),"<nat>"),J(w,"<alphaplus>"))),"<nat>"));t.nat=L,t.currentPos=e=>h(e.pos.clone(),!1),t.pSplice=e=>N(D(L,O("###"),q("###")),(t=>v(e.getSplice(t))))(e)},738:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=class{constructor(e){this._iter=e,this._currentIndex=0,this._firstIndex=0,this._buffer=[],this._checkpoints=[]}next(){if(0===this._fetch(1))return{done:!0};let e={value:this._at(this._currentIndex++),done:!1};return this._collect(),e}_ind2buf(e){return e-this._firstIndex}_at(e){return this._buffer[this._ind2buf(e)]}_fetch(e){let t=e-(this._buffer.length-this._ind2buf(this._currentIndex));for(;t>0;){let e=this._iter.next();if(e.done)break;t--,this._buffer.push(e.value)}return e-t}_collect(){let e=0===this._checkpoints.length?this._currentIndex-this._firstIndex:this._checkpoints[0].index-this._firstIndex;this._firstIndex+=e,this._buffer.splice(0,e)}checkpoint(e){this._checkpoints.push({index:this._currentIndex,value:e})}forgetCheckpoint(){if(void 0===this._checkpoints.pop())throw"Trying to forget a nonexisting checkpoint in PeekIterator";this._collect()}reset(){if(0===this._checkpoints.length)throw"Trying to reset to a nonexisting checkpoint in PeekIterator";let e=this._checkpoints.pop();return this._currentIndex=e.index,this._collect(),e.value}peek(){return this._fetch(1),this._at(this._currentIndex)}peekMany(e){return this._fetch(e),this._buffer.slice(this._ind2buf(this._currentIndex),this._ind2buf(this._currentIndex+e))}}},268:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RefListNode=t.RefList=t.PriorityList=t.OneToManyMap=t.ObservableReference=t.ListNode=t.LinkedList=t.BinaryHeap=void 0,t.adjacentFind=_,t.bisame=v,t.bisimilar=function(e,t){return b(((e,t)=>i(e,t)),e,t)},t.clear=function(e){e.length=0},t.copy=function e(t){return function(t){if(Array.isArray(t))return t.map((t=>e(t)));if(t instanceof Set)return new Set(t);if(t instanceof Map)return new Map(p((([t,n])=>[t,e(n)]),t));if("object"==typeof t&&null!==t){if("function"==typeof t.copy)return t.copy();{let n=Object.create(Object.getPrototypeOf(t));for(let r of Object.keys(t))n[r]=e(t[r]);return n}}return"function"==typeof t&&"function"==typeof t.copy?t.copy():t}(t)},t.count=function(e){let t=0;for(let n of e)++t;return t},t.equals=i,t.every=function(e,t){for(let n of t)if(!e(n))return!1;return!0},t.every2=b,t.filter=function(e,t){return{[Symbol.iterator]:()=>{const n=t[Symbol.iterator]();let r={next:()=>{let t,r=!1;do{({done:r,value:t}=n.next())}while(!r&&!e(t));return{done:r,value:t}}};return"function"==typeof n.return&&(r.return=e=>n.return(e)),"function"==typeof n.throw&&(r.throw=e=>n.throw(e)),r}}},t.first=function(e){const t=e[Symbol.iterator]();let n=t.next();return n.done?void 0:("function"==typeof t.return&&t.return(),n.value)},t.firstKeepOpen=function(e){let t=e[Symbol.iterator]().next();return t.done?void 0:t.value},t.foldl=function(e,t,n){let r=t;for(let t of n)r=e(t,r);return r},t.forEach=function(e,t){for(let n of t)e(n);return e},t.isSortedBy=function(e,t){return null===_(((t,n)=>!e(t,n)),t)},t.isUnique=function(e){return 1===S(e)},t.iterableToIterator=d,t.iteratorToIterable=f,t.join=function(e){return{[Symbol.iterator]:()=>{let t,n=d(e),r=!0,s=!1;return{next:()=>{if(s)return{done:!0};let e,o;for(;;){if(!0===r){if(e=n.next(),e.done)return{done:!0};t=d(e.value)}if(o=t.next(),!o.done)return r=!1,{done:!1,value:o.value};r=!0}},return:e=>(s||(s=!0,r||"function"!=typeof t.return||t.return(e)),{done:!0,value:e}),throw:e=>{if(s)throw e}}}}},t.map=p,t.mapEquals=function(e,t){if(e.size!==t.size)return!1;for(let[n,r]of e)if(!i(t.get(n),r))return!1;return!0},t.mkEmptyIterable=h,t.mkEmptyIterator=function(){return{next:()=>({done:!0,value:void 0})}},t.mkRefCounted=function(e,t,n){return r.hdconsole.assert(0===S(e),"trying to make an object reference counted twice"),g.set(e,t),null!=n&&w.set(e,n),y.set(e,1),e},t.mkSingletonIterable=function*(e){yield e},t.modifyMapValue=l,t.nonnull_cast=function(e){return e},t.orderedMapEquals=u,t.orderedSetEquals=a,t.refCount=S,t.release=k,t.rest=function(e){let t=d(e);return t.next(),f(t)},t.retain=function(e){let t=y.get(e);return null==t?(r.hdconsole.assert(null!=t,"trying to retain a non-refcounted object"),y.set(e,NaN)):y.set(e,t+1),e},t.sameElements=function(e,t){let n=new Map;for(let t of e)l(n,t,(e=>null==e?1:e+1));for(let e of t){let t=n.get(e);if(1===t)n.delete(e);else{if(void 0===t)return!1;n.set(e,t-1)}}return 0===n.size},t.setDifference=function(e,t){let n=new Set;for(let r of e)t.has(r)||n.add(r);return n},t.setDifferenceTo=function(e,t){for(let n of t)e.delete(n)},t.setEquals=function(e,t){if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n))return!1;return!0},t.setUnion=function(e,t){let n=new Set;return c(n,e),c(n,t),n},t.setUnionTo=c,t.setUnionToWithDiff=function(e,t){let n=new Set;for(let r of t)e.has(r)||(e.add(r),n.add(r));return n},t.setUniqueHandler=function(e,t){w.set(e,t)},t.some=function(e,t){for(let n of t)if(e(n))return!0;return!1},t.subsetOf=function(e,t){for(let n of e.keys())if(!t.has(n))return!1;return!0},t.throw_on_null=function(e){if(null==e)throw"Expected non-null";return e},t.until=function(e,t){return{[Symbol.iterator]:()=>{const n=t[Symbol.iterator]();let r={},s=()=>n.next();return r.done=!1,r.next=()=>{if(r.done)return{done:!0};let{done:t,value:o}=s();return s=()=>n.next(),t?(r.done=!0,{done:!0}):(t=e(o),t?("function"==typeof n.return&&n.return(),{done:!0}):{done:!1,value:o})},"function"==typeof n.return&&(r.return=e=>n.return(e)),"function"==typeof n.throw&&(r.throw=e=>(s=()=>n.throw(e),r.next())),r}}},t.zip=function(e,t){return m(((e,t)=>[e,t]),e,t)},t.zipWith=m;var r=n(775),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=s?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=e[i]}return r.default=e,n&&n.set(e,r),r}(n(534));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function i(e,t){const n=e,r=t;if(n===r)return!0;if(Array.isArray(n)&&Array.isArray(r)){if(n.length!==r.length)return!1;for(let e=0;e<n.length;++e)if(!i(n[e],r[e]))return!1;return!0}if(n instanceof Set&&r instanceof Set)return a(n,r);if(n instanceof Map&&r instanceof Map)return u(n,r);if("object"==typeof n&&null!==n){if("function"==typeof n.equals)return n.equals(r);if(null!=r){let e=Object.keys(n),t=Object.keys(r);if(e.length!==t.length)return!1;for(let t of e)if(!i(n[t],r[t]))return!1;return!0}}return"function"==typeof n&&"function"==typeof n.equals&&n.equals(r)}function a(e,t){return e.size===t.size&&v(e,t)}function u(e,t){return e.size===t.size&&b((([e,t],[n,r])=>e===n&&i(t,r)),e,t)}function l(e,t,n){let r=n(e.get(t));return e.set(t,r),r}function c(e,t){for(let n of t)e.add(n)}function*h(){}function f(e){let t={};return t[Symbol.iterator]=function(){return e},t}function d(e){return e[Symbol.iterator]()}function p(e,t){return{[Symbol.iterator]:()=>{const n=t[Symbol.iterator]();let r={next:()=>{const{done:t,value:r}=n.next();return{done:t,value:t?void 0:e(r)}}};return"function"==typeof n.return&&(r.return=e=>n.return(e)),"function"==typeof n.throw&&(r.throw=e=>n.throw(e)),r}}}function _(e,t){let n=d(t),r=n.next();if(r.done)return null;let s=r.value;for(;;){let t=n.next();if(t.done)return null;if(e(s,t.value))return"function"==typeof n.return&&n.return(),[s,t.value];s=t.value}}function m(e,t,n){let r=!1;return{[Symbol.iterator]:()=>{const s=t[Symbol.iterator](),o=n[Symbol.iterator]();return{next:()=>{if(r)return{done:!0};const t=s.next(),n=o.next();return r=t.done||n.done,t.done||"function"!=typeof s.return||s.return(),n.done||"function"!=typeof o.return||o.return(),r?{done:!0}:{done:!1,value:e(t.value,n.value)}},return:e=>("function"==typeof s.return&&s.return(),"function"==typeof o.return&&o.return(),r=!0,{done:!0,value:e})}}}}function v(e,t){return b(((e,t)=>e===t),e,t)}function b(e,t,n){const r=t[Symbol.iterator](),s=n[Symbol.iterator]();for(;;){const t=r.next(),n=s.next();if(!t.done&&!n.done){if(e(t.value,n.value))continue;return!1}if(t.done&&n.done)return!0;if(!t.done)return"function"==typeof r.return&&r.return(),!1;if(!n.done)return"function"==typeof s.return&&s.return(),!1}return!0}t.OneToManyMap=class{constructor(){this._m=new Map}hasKey(e){return this._m.has(e)}keys(){return this._m.keys()}values(e){let t=this._m.get(e);return void 0!==t?t.values():h()}countKeys(){return this._m.size}count(e){let t=this._m.get(e);return void 0===t?0:t.size}addKey(e){return void 0===this._m.get(e)&&this._m.set(e,new Set),this}add(e,t){let n=this._m.get(e);return void 0===n&&(n=new Set,this._m.set(e,n)),n.add(t),this}addMany(e,t){let n=this._m.get(e);void 0===n&&(n=new Set,this._m.set(e,n));for(let e of t)n.add(e)}remove(e,t){let n=this._m.get(e);return void 0!==n&&n.delete(t)}removeKey(e){this._m.delete(e)}clear(){this._m.clear()}};let y=new WeakMap,g=new WeakMap,w=new WeakMap;function k(e){let t=y.get(e);if(r.hdconsole.assert(null!=t&&t>0,"trying to release an already released object"),--t,y.set(e,t),t>1)return t;if(1===t){let t=w.get(e);null!=t&&t(e)}else{let t=g.get(e);null!=t&&t(e)}return t}function S(e){let t=y.get(e);return void 0===t?0:t}t.RefList=class{constructor(){this._head=null}front(){if(null!=this._head)return this._head.data}pushFront(e){return this._head=new M(this._head,e),this._head}};class M{constructor(e,t){console.assert(S(t)>0),this.next=e,this.data=t}releaseTail(){let e=this.next;for(;null!=e;)k(e.data),e=e.next;this.next=null}}t.RefListNode=M;class x{constructor(e,t,n){this.prev=e,this.next=t,this.data=n}}t.ListNode=x;class O{constructor(){this._head=null,this._tail=null,this._size=0}insertNode(e,t){return null==e?(t.prev=this._tail,t.next=null,this._tail=t):(t.prev=e.prev,t.next=e,e.prev=t),null==t.prev?this._head=t:t.prev.next=t,this._size++,t}insert(e,t){return this.insertNode(e,new x(null,null,t))}pushFront(e){return this.insert(this._head,e)}pushNodeFront(e){return this.insertNode(this._head,e)}pushBack(e){return this.insert(null,e)}pushNodeBack(e){return this.insertNode(null,e)}removeNode(e){return null==e.next?this._tail=e.prev:e.next.prev=e.prev,null==e.prev?this._head=e.next:e.prev.next=e.next,this._size--,e}remove(e){return this.removeNode(e).data}popFront(){return null==this._head?null:this.remove(this._head)}popBack(){return null==this._tail?null:this.remove(this._tail)}[Symbol.iterator](){let e=this._head;return{next:()=>{if(null==e)return{done:!0};{let t={value:e.data,done:!1};return e=e.next,t}}}}reverseIterator(){let e=this._tail;return{next:()=>{if(null==e)return{done:!0};{let t={value:e.data,done:!1};return e=e.prev,t}}}}}t.LinkedList=O;class P{size(){return this._list._size}constructor(){this._nodeMap=new Map,this._list=new O,this._highestPriority=-1,this._lowestPriority=0}_access(e){let t=this._nodeMap.get(e);if(null==t&&console.log(null==e?void 0:e.name),null==t&&console.log(this.size()),r.hdconsole.assert(null!=t,"element not found in priority list"),null==t)throw"Should not happen, element not found in priority list";return t}remove(e){let t=this._nodeMap.get(e);null!=t&&(this._nodeMap.delete(e),this._list.remove(t))}promote(e){let t=this._access(e);t.data.priority=++this._highestPriority,this._list.pushNodeFront(this._list.removeNode(t))}demote(e){let t=this._access(e);t.data.priority=--this._lowestPriority,this._list.pushNodeBack(this._list.removeNode(t))}get highestPriority(){return this._highestPriority}get lowestPriority(){return this._lowestPriority}priority(e){return this._access(e).data.priority}pushBack(e){this._nodeMap.set(e,this._list.pushBack({data:e,priority:--this._lowestPriority}))}pushFront(e){this._nodeMap.set(e,this._list.pushFront({data:e,priority:++this._highestPriority}))}entries(){return p((e=>e.data),this)}[Symbol.iterator](){return this._list[Symbol.iterator]()}hasHigherPriority(e,t){return this._access(e).data.priority>this._access(t).data.priority}}t.PriorityList=P;var C=new WeakSet;function j(){null!=this._subscription&&(this._subscription.unsubscribe(),this._subscription=null)}t.ObservableReference=class{constructor(e=null){var t,n;(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t=this,n=C),n.add(t),this._value=e,this._subject=new s.Subject((e=>{e.next(this._value)})),this._subscription=null}subscribe(e){return this._subject.subscribe(e)}get value(){return this._value}set value(e){(function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n})(this,C,j).call(this),this._setValue(e)}_setValue(e){null!==this._value&&this._subject.sendNext(null),this._value=e,null!==e&&this._subject.sendNext(e)}link(e){const t=this._value;this._subscription,this.value=null,this._subscription=e.subscribe((e=>{this._setValue(e)})),null!=t&&!0===t.hasOwnProperty("_subject")&&"function"==typeof(null==t?void 0:t._subject).sendComplete&&(null==t||t._subject.sendComplete())}},t.BinaryHeap=class{constructor(e){this._cmp=e,this._data=[null]}size(){return this._data.length-1}empty(){return 0===this.size()}_swap(e,t){let n=this._data[e];this._data[e]=this._data[t],this._data[t]=n}_percolateUp(e){let t=e;for(;t>=2;){let e=Math.floor(t/2);if(!this._cmp(this._data[t],this._data[e]))break;this._swap(t,e),t=e}}push(e){this._data.push(e),this._percolateUp(this.size())}_percolateDown(e){let t=e;for(;2*t<=this.size();){let e=this._minOfSiblings(2*t);if(this._cmp(this._data[t],this._data[e]))break;this._swap(t,e),t=e}}_minOfSiblings(e){return e>=this.size()||this._cmp(this._data[e],this._data[e+1])?e:e+1}pop(){let e=this._data[1],t=this._data.pop();return this.size()>0&&(this._data[1]=t,this._percolateDown(1)),e}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}var __webpack_exports__=__webpack_require__(707);return __webpack_exports__})()}));
//# sourceMappingURL=hotdrink.js.map