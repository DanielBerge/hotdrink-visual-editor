!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hd",[],t):"object"==typeof exports?exports.hd=t():e.hd=t()}(self,(function(){return(()=>{"use strict";var __webpack_modules__={329:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EvaluationGraph=t.MethodActivation=t.VariableActivation=t.TrackingPromise=t.Deferred=void 0,(n=r(927))&&n.__esModule;var n,s=r(292),o=r(268);class i{constructor(){this._promise=new Promise(((e,t)=>{this.resolve=t=>{e(t)},this.reject=e=>{t(e)}}))}get promise(){return this._promise}}t.Deferred=i;class a{constructor(e,t){this._promise=e,this._fulfillTracker=t}then(e,t){return null!=e&&this._fulfillTracker(),this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}}t.TrackingPromise=a;class u{constructor(e){this._pending=!1,this._variable=e,this._deferred=new i,this._outMethods=new Set,this._inMethod=null,(0,o.mkRefCounted)(this,(e=>{e.reject(u.abandoned),e._inMethod=null}))}get name(){return this._variable.name}get inMethod(){return this._inMethod}get outMethods(){return this._outMethods}outMethodsSize(){return this._outMethods.size}addOutMethod(e){this._outMethods.add(e)}setInMethod(e){this._inMethod=e}resolve(e){return this._pending=!1,this._deferred.resolve(e)}reject(e){return this._pending=!1,this._deferred.reject(e)}get promise(){return this._deferred.promise}}t.VariableActivation=u,u.abandoned={},t.MethodActivation=class{constructor(e,t){this._f=e,this._mask=t}get ins(){return this._ins}get outs(){return this._outs}insSize(){return this._ins.length}outsSize(){return this._outs.length}async execute(e,t){this._ins=e,this._outs=t,t.forEach((e=>e.setInMethod(this))),e.forEach((e=>(0,o.retain)(e)));let r=t.map((e=>e.promise.then((e=>null),(e=>null))));Promise.all(r).then((()=>{e.forEach((e=>{(0,o.release)(e)}))}));let n,u=e.filter(((e,t)=>0==(this._mask[t]&s.maskPromise))),l=e.filter(((e,t)=>0!=(this._mask[t]&s.maskUpdate))),c=l.length;if(c>0){let e=new i,t=[];for(let r=0;r<l.length;++r)t.push(l[r].name),(0,o.setUniqueHandler)(l[r],(t=>{0==--c&&e.resolve(null)}));await e.promise}try{n=await Promise.all(u.map((e=>e.promise)))}catch(e){return void t.forEach((e=>e.reject("hotdrink.js method's input was rejected")))}let h,f=[],d=0;for(let t=0;t<e.length;++t)0!=(this._mask[t]&s.maskPromise)?f[t]=new a(e[t].promise,(()=>e[t].addOutMethod(this))):(e[t].addOutMethod(this),f[t]=n[d++]);try{h=await this._f(...f)}catch(e){return void t.forEach((t=>t.reject(e)))}if(t.length>1){console.assert(Array.isArray(h)&&t.length==h.length,`Method result shoud be an array of ${t.length} elements`);for(let e=0;e<h.length;++e)t[e].resolve(h[e])}else t[0].resolve(h)}},t.EvaluationGraph=class{adjacentOutVertices(e){return e instanceof u?e.outMethods:e.outs}outDegree(e){return e instanceof u?e.outMethodsSize():e.outsSize()}adjacentInVertices(e){return e instanceof u?null!=e.inMethod?[e.inMethod]:[]:e.ins}inDegree(e){return e instanceof u?null!=e.inMethod?1:0:e.insSize()}}},230:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.component=function(e,...t){let r=(0,n.hdl)(e,...t),s=(0,n.must)((0,n.pBind_)(n.manyws,(0,n.oneOf)(U,B((0,a.freshComponentName)()))))(r);return(0,n.must)(n.eof)(r),q(p(M(s.value)))},t.left=c,t.right=h,t.isLeft=f,t.isRight=function(e){return 1===e.tag},t.asLeft=d,t.asRight=p,t.withPos=_,t.checkQualifiers=y,t.checkParameterList=g,t.checkFirstMethod=w,t.checkOtherMethod=k,t.checkConstraint=S,t.checkComponent=M,t.jsCode=x,t.stringLiteral=C,t.templateLiteral=j,t.pMethod=V,t.qualifierList=T,t.qualifiedParameterList=A,t.pVariables=D,t.pConstraint=z,t.topComponent=B,t.pComponent=U,t.buildComponent=q,Object.defineProperty(t,"hdl",{enumerable:!0,get:function(){return n.hdl}}),Object.defineProperty(t,"mkParseState",{enumerable:!0,get:function(){return n.mkParseState}}),Object.defineProperty(t,"ParseState",{enumerable:!0,get:function(){return n.ParseState}}),t.functionBody=t.block=t.TypeError=t.SetScope=t.ComponentScope=t.RIGHT=t.LEFT=void 0,l(r(779));var n=r(316),s=(r(877),l(r(894))),o=l(r(916)),i=l(r(137)),a=(l(r(831)),r(292)),u=r(268);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return{tag:0,value:e}}function h(e){return{tag:1,value:e}}function f(e){return 0===e.tag}function d(e){if(0!==e.tag)throw"Either cast error: no value on left";return e.value}function p(e){if(1!==e.tag)throw e.value;return e.value}function _(e){return(0,n.lift2)(((e,t)=>({pos:e,value:t})))(n.currentPos,e)}t.LEFT=0,t.RIGHT=1;class m{constructor(e){this._component=e}get(e){let t=this._component;for(;null!=t;){let r=t.variableDeclarations.get(e);if(void 0!==r)return r;t=t.parent}}has(e){return void 0!==this.get(e)}}t.ComponentScope=m;class v{constructor(e){this._set=e}get(e){return this.has(e)?e:void 0}has(e){return this._set.has(e)}}t.SetScope=v;class b extends Error{constructor(e,t){super(),this._msg=e,this._pos=t}get message(){return this._pos.toString()+"\n"+this._msg}set message(e){throw Error("Cannot set the name of ParseError")}}function y(e){if(e.length>1){let t=new Set;for(let r of e){if(t.has(r.value))return c(new b(`The same qualifier ${r.value} appears twice`,r.pos));t.add(r.value)}}return h(null)}function g(e,t){let r=new Set;for(let n of e){let e=y(n.value.qualifiers);if(f(e))return c(d(e));let s=n.value.parameterName;if(!t.has(s.value))return c(new b(`Undefined variable name ${s.value}`,s.pos));if(r.has(s.value))return c(new b(`Parameter ${s.value} appears twice in the same parameter list`,s.pos));r.add(s.value)}return h(r)}function w(e,t){let r=g(e.ins,t);if(f(r))return r;let n=g(e.outs,t);return f(n)?n:h((0,u.setUnion)(p(r),p(n)))}function k(e,t){let r=new v(t),n=g(e.ins,r);if(f(n))return c(d(n));let s=g(e.outs,r);if(f(s))return c(d(s));let o=(0,u.setUnion)(p(n),p(s));if(!(0,u.setEquals)(o,t)){let r=Array.from((0,u.setDifference)(t,o)).join();return c(new b("All methods in the same constraint must use the same variables; this method does not refer to variable "+r,e.pos))}return h(null)}function S(e,t){if(0===e.methods.length)return e.variableNames=new Set,h(e);let r=w(e.methods[0],t);if(f(r))return c(d(r));e.variableNames=p(r);for(let t=1;t<e.methods.length;++t){let n=k(e.methods[t],p(r));if(f(n))return c(d(n))}return h(e)}function M(e){for(let t of e.constraints){let r=S(t,new m(e));if(f(r))return c(d(r))}for(let t of e.components){let e=M(t);if(f(e))return c(d(e))}return h(e)}function x(e,t=!0){return r=>{let s="";for(;;){let o=r.peek();if(null==o)return e.includes("")?(0,n.ok)(s,s.length>0):(0,n.failF)((()=>["<js code>"].concat(e)),s.length>0);if(e.includes(o))return t&&((0,n.item)(r),s+=o),(0,n.ok)(s);if(["}","]",")"].includes(o))return(0,n.fail)(["not "+o],!0);let i=(0,n.oneOf)(C,j,(0,n.pBind)((0,n.sat)(O),(e=>(0,n.pBind)(x([P(e)],!0),(t=>(0,n.ret)(e+t))))),n.item)(r);if(!i.success)return i;s+=i.value}throw null}}function O(e){return"("==e||"{"==e||"["==e}function P(e){switch(e){case"(":return")";case"{":return"}";case"[":return"]"}throw Error("HotDrink internal error: no closing brace defined for "+e)}function C(e){let t=(0,n.oneOf)((0,n.pChar)("'"),(0,n.pChar)('"'))(e);if(!t.success)return t;const r=t.value,s="\\"+r;let o=t.value;return t=(0,n.lift)(((e,t)=>o+e.join("")+t),(0,n.many)((0,n.oneOf)((0,n.exactString)("\\\\"),(0,n.exactString)(s),(0,n.sat)((e=>e!=r)))),(0,n.pChar)(r))(e),t.consumed=!0,t}function j(e){const t="`";let r=(0,n.pChar)(t)(e);if(!r.success)return r;let s=r.value;for(;;){let r=(0,n.must)((0,n.oneOf)((0,n.pChar)(t),(0,n.exactString)("${"),(0,n.exactString)("\\\\"),(0,n.exactString)("\\`"),n.item))(e);if(r.value==t){s+=t;break}"${"!=r.value?s+=r.value:(s+="${",s+=(0,n.must)(x(["}"]))(e).value)}return(0,n.ok)(s)}t.TypeError=b;const N=(0,n.context)("<function body block>",(0,n.token)((0,n.lift)(((e,t)=>e+t),(0,n.pChar)("{"),x(["}"]))));t.block=N;const E=(0,n.context)("<function body>",(0,n.oneOf)(N,(0,n.pBind)((0,n.token)(x([";"])),(e=>(0,n.ret)("return "+e)))));function V(e){const t=_((0,n.oneOf)((0,n.lift)(((e,t)=>e),n.pSplice,(0,n.word)(";")),(0,n.pBind_)((0,n.word)("=>"),E),N));return(0,n.context)("<method>",(0,n.lift)((function(e,t,r,n,s){let o=r.map((e=>(0,u.foldl)(((e,t)=>function(e){switch(e){case"*":return a.maskPromise;case"!":return a.maskUpdate;default:return a.maskNone}}(e)|t),a.maskNone,e.value.qualifiers.map((e=>e.value)))));const i=r.map((e=>e.value.parameterName.value));let l;return l="string"==typeof s.value?{pos:s.pos,value:new Function(i.join(),s.value)}:s,{pos:e,name:t,ins:r,outs:n,code:l,promiseMask:o}}),n.currentPos,(0,n.opt)(_(n.identifier),null),(0,n.ignore)((0,n.word)("(")),A("*!"),(0,n.ignore)((0,n.word)("->")),A(""),(0,n.ignore)((0,n.word)(")")),t))(e)}function T(e){return(0,n.many)((0,n.token)(_((0,n.pChars)(e))))}function A(e="*!"){return(0,n.sepList)(_((0,n.lift)(((e,t)=>({qualifiers:e,parameterName:t})),T(e),_(n.identifier))),(0,n.word)(","))}function D(e){return(0,n.inBetween)((0,n.sepList)(R,(0,n.word)(",")),(0,n.word)("var"),(0,n.word)(";"))(e)}function R(e){return(0,n.pBind)(n.currentPos,(e=>(0,n.oneOf)((0,n.lift)((t=>({pos:e,name:t,isReference:!0})),(0,n.ignore)((0,n.word)("&")),n.identifier),(0,n.lift)(((t,r)=>({pos:e,name:t,isReference:!1,initializer:r})),n.identifier,(0,n.opt)(_(I),void 0)))))(e)}function I(e){return(0,n.pBind_)((0,n.word)("="),(0,n.context)("<intitializer-expression>",(0,n.pBind)(x([",",";"],!1),(e=>(0,n.ret)(new Function("return "+e)())))))(e)}function z(e){return(0,n.context)("<constraint>",(0,n.lift)(((e,t,r)=>({pos:e,name:t,variableNames:null,methods:r})),n.currentPos,(0,n.ignore)((0,n.word)("constraint")),(0,n.opt)(_(n.identifier),null),(0,n.ignore)((0,n.word)("{")),(0,n.many)(V),(0,n.ignore)((0,n.word)("}"))))(e)}t.functionBody=E;const F=(e,t,r)=>{let n=new Map,s=[],o=[],i={parent:null,pos:e,name:t,variableDeclarations:n,constraints:s,components:o};for(let e of r)switch(e.tag){case"variable":for(let t of e.value)n.set(t.name,t);break;case"constraint":s.push(e.value);break;case"component":e.value.parent=i,o.push(e.value)}return i},J=(0,n.many)((0,n.oneOf)((0,n.pBind)(D,(e=>(0,n.ret)({tag:"variable",value:e}))),(0,n.pBind)(z,(e=>(0,n.ret)({tag:"constraint",value:e}))),(0,n.pBind)(U,(e=>(0,n.ret)({tag:"component",value:e})))));function B(e){return t=>(0,n.lift)(F,n.currentPos,_((0,n.ret)(e)),J)(t)}function U(e){return(0,n.context)("<component>",(0,n.lift)(F,n.currentPos,(0,n.ignore)((0,n.word)("component")),_(n.identifier),(0,n.ignore)((0,n.word)("{")),J,(0,n.ignore)((0,n.word)("}"))))(e)}function q(e,t=null){let r=new s.default(e.name.value);null!=t&&t.addComponent(r);for(let t of e.variableDeclarations.values())if(t.isReference)r.emplaceVariableReference(t.name);else{let e=null!=t.initializer?t.initializer.value:void 0;r.emplaceVariable(t.name,e)}return e.constraints.forEach((e=>function(e,t){let r=t.variableNames;if(null==r)throw Error("Constraint node must be type checked before it is used for building hotdrink.js constraint");let n=new Map,s=0;for(let e of r)n.set(e,s++);let a=t.methods.map((e=>{return t=e,r=n,new i.default(r.size,t.ins.map((e=>r.get(e.value.parameterName.value))),t.outs.map((e=>r.get(e.value.parameterName.value))),t.promiseMask,t.code.value,(null==t||null===(s=t.name)||void 0===s?void 0:s.value)||"");var t,r,s})),u=Array.from(n.keys(),(t=>e.getVariableReference(t))),l=new o.default(a),c=null!=t.name?t.name.value:null;return e.emplaceConstraint(c,l,u,!1)}(r,e))),e.components.forEach((e=>q(e,r))),r}},894:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(775),s=(a(r(916)),a(r(98)),a(r(831))),o=(a(r(927)),a(r(779))),i=r(292);function a(e){return e&&e.__esModule?e:{default:e}}class u{constructor(e){this._owner=null,this._system=null,this._name=e,this._vars=new Set,this._varRefs=new Map,this._varRefNames=new Map,this._constraints=new Map,this._constraintNames=new Map,this._nextFreshCIndex=0,this._components=new Map}clone(e=(0,i.freshComponentName)()){let t=new u(e),r=new Map;for(let[e,n]of this._varRefs)n.isOwningReference()?r.set(n,t.emplaceVariable(e)):r.set(n,t.emplaceVariableReference(e));for(let[e,n]of this._constraints){let s=n._varRefs.map((e=>r.get(e)));(0,i.isStay)(n)||t.emplaceConstraint(e,n._cspec,s,n._optional)}for(let[e,r]of this._components)t.addComponent(r.clone(e));return t}get system(){return this._system}get name(){return this._name}connectSystem(e){return null!=this._owner?(n.hdconsole.error(`Tried to connect the nested component ${this._name}`),!1):this._system===e?(n.hdconsole.warn(`Same system connected twice to component ${this._name}`),!1):null!=this._system?(n.hdconsole.error(`Trying to connect an already connected component ${this._name} to a another system`),!1):(this._connectSystem(e),!0)}_connectSystem(e){this._system=e;for(let t of this._components.values())t._connectSystem(e);for(let t of this._constraints.values())0===t._danglingCount&&e.addConstraint(t)}disconnectSystem(){return null==this._system?(n.hdconsole.error(`Tried to disconnect a component ${this._name} that is already disconnected`),!1):null!=this._owner?(n.hdconsole.error(`Tried to disconnect a subcomponent ${this._name} when owner is still connected`),!1):(this._disconnectSystem(),!0)}_disconnectSystem(){for(let e of this._components.values())e._disconnectSystem();for(let e of this._constraints.values())this._system.removeConstraint(e);this._system=null}addComponent(e){null==e._owner?null==e._system?this._components.has(e._name)?n.hdconsole.error(`Tried to add the component whose name ${e._name} already exists`):(e._owner=this,this._components.set(e._name,e),null!=this._system&&e.connectSystem(this._system)):n.hdconsole.error(`Tried to add to component ${this._name} the component ${e._name} that is connected to a system`):n.hdconsole.error(`Tried to add component ${e._name} that already has an owner to component ${this._name}`)}emplaceVariable(e,t){n.hdconsole.assert(!this._varRefs.has(e),`Trying to add variable ${e} twice to component ${this._name}`);let r=(0,i.mkVariable)(this,t);this._varRefs.set(e,r),this._varRefNames.set(r,e),this._vars.add(r.value);let s="__stay__"+e,a=new o.default(this,(0,i.stayConstraintSpec)(),[r],!0);return this._constraints.set(s,a),this._constraintNames.set(a,s),r}emplaceVariableReference(e){n.hdconsole.assert(!this._varRefs.has(e),`Trying to add variable reference ${e} twice to component ${this._name}`);let t=new s.default(this);return this._varRefs.set(e,t),this._varRefNames.set(t,e),t}emplaceConstraint(e,t,r,n=!1){let s=new o.default(this,t,r,n);if(null==e&&(e=this._nextFreshConstraintName()),this._constraints.has(e))throw`Constraint ${e} already exists in component ${this._name}`;return this._constraints.set(e,s),this._constraintNames.set(s,e),s}_nextFreshConstraintName(){return"c#"+this._nextFreshCIndex++}variableReferenceName(e){let t=this._varRefNames.get(e);return null==t?"<unnamed>":t}constraintName(e){return this._constraintNames.get(e)}getVariableReference(e){let t=this._varRefs.get(e);return null!=t?t:null!=this._owner?this._owner.getVariableReference(e):void 0}get vs(){const e=this;function t(t){return e._varRefs.get(t)}return new Proxy({},{get:function(e,r){return t(r)},set:function(e,r,s){let o=t(r);return null==o?(n.hdconsole.warn(`Linking an unknown variable ${r}`),!1):(o.link(s),!0)}})}get cs(){const e=this;return new Proxy({},{get:function(t,r){return e._constraints.get(r)}})}get components(){const e=this;return new Proxy({},{get:function(t,r){return e._components.get(r)}})}}t.default=u},916:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(775),s=(o(r(137)),o(r(831)),r(268));function o(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(e){this._methods=new Set(e),n.hdconsole.assert(this._methods.size>0,"Constraint specification must have at least one method.");const t=(0,s.first)(this._methods);if(null==t)throw"Constraint specification must have at least one method.";const r=null==t?void 0:t.nvars;this._nvars=r,this._v2ins=[];for(let e=0;e<r;++e)this._v2ins.push([]);for(let e of this._methods){n.hdconsole.assert(e.nvars===r,"All methods in constraint specification must have the same number of variables");for(let t of e.outs())this._v2ins[t].push(e)}}get nvars(){return this._nvars}ins(e){return this._v2ins[e]}insSize(e){return this._v2ins[e].length}methods(){return this._methods}hasMethod(e){return this._methods.has(e)}prettyPrint(e,t){let r="";for(let n of this._methods)r+=e+n.prettyPrint(t)+"\n";return r}}},292:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mkVariable=function(e,t){let r=new n.default(e);return r.value=new s.default(r,t),r},t.freshNameGenerator=l,t.isOwnerOf=function(e,t){for(;e!==t;){if(null==t._owner)return!1;t=t._owner}return!0},t.isConstraint=function(e){return e.hasOwnProperty("_cspec")},t.isVariable=function(e){return e.hasOwnProperty("_activation")},t.isMethod=function(e){return e.hasOwnProperty("_promiseMask")},t.isStay=function(e){const t=(0,a.first)(e._cspec._methods);return null!=t&&1===t.nvars&&"hotdrink.js => hotdrink.js"===t.code.toString()},t.enforceStayMethod=function(e){e.selectedMethod=(0,a.first)(e._cspec._methods)},t.toMask=function(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return 0}},t.stayConstraintSpec=function(){return new i.default([new o.default(1,[0],[0],[0],(e=>e),"stay")])},t.maskPromiseUpdate=t.maskUpdate=t.maskPromise=t.maskNone=t.freshComponentName=void 0,u(r(894));var n=u(r(831)),s=u(r(927)),o=(u(r(779)),u(r(137))),i=u(r(916)),a=r(268);function u(e){return e&&e.__esModule?e:{default:e}}function l(e){let t=0;return()=>e+t++}const c=l("comp#");t.freshComponentName=c,t.maskNone=0,t.maskPromise=1,t.maskUpdate=2,t.maskPromiseUpdate=3},98:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(17),s=r(329),o=r(775),i=(c(r(894)),c(r(137)),c(r(927)),r(391)),a=c(r(341)),u=r(292),l=r(268);function c(e){return e&&e.__esModule?e:{default:e}}t.default=class{allConstraints(){return(0,l.join)([this._musts,this._optionals.entries()])}addComponent(e){return e.connectSystem(this)}removeComponent(e){return e.system!=this?(console.warn(`Tried to remove component ${e._name} from a constraint system in which it does not exist.`),!1):e.disconnectSystem()}prettyPrint(){let e="-- musts --\n";for(let t of this._musts)e+=t.prettyPrint();e+="-- optionals --\n";for(let t of this._optionals.entries())e+=t.prettyPrint();return e}constructor(){this._optionals=new l.PriorityList,this._musts=new Set,this._dirty=new Set,this._v2cs=new l.OneToManyMap,this._usg=new i.UpstreamSolutionGraph(this),this._dsg=new i.DownstreamSolutionGraph(this)}update(){this.plan(this.allConstraints()),this.solveFromConstraints(this.allConstraints())}variables(){return this._v2cs.keys()}constraints(e){return this._v2cs.values(e)}*allConstraints(){for(let e of this._musts)yield e;for(let e of this._optionals.entries())yield e}isMust(e){return this._musts.has(e)}isOptional(e){return!this._musts.has(e)}addConstraint(e){for(let t of e.variables())this._v2cs.add(t,e);e._optional?this._optionals.pushBack(e):this._musts.add(e),this._dirty.add(e)}removeConstraint(e){for(let t of e.variables())this._v2cs.remove(t,e),0==this._v2cs.count(t)&&this._v2cs.removeKey(t);e._optional?this._optionals.remove(e):this._musts.delete(e),this._dirty.delete(e)}setDirty(e){this._dirty.add(e)}gatherUpstreamConstraints(e){return(0,l.filter)((e=>(0,u.isConstraint)(e)),(0,n.reverseTopoSortFrom)(this._usg,e))}gatherDownstreamConstraints(e){return(0,l.filter)((e=>(0,u.isConstraint)(e)),(0,n.reverseTopoSortFrom)(this._dsg,e))}gatherDownstreamVariables(e){return(0,l.filter)((e=>(0,u.isVariable)(e)),(0,n.reverseTopoSortFrom)(this._dsg,e))}promoteVariable(e){this.promoteConstraint(this.getStay(e))}promoteConstraint(e){this._optionals.promote(e)}demoteConstraint(e){this._optionals.demote(e)}strength(e){return this.isMust(e)?this._optionals.highestPriority+1:this._optionals.priority(e)}getStay(e){for(let t of this._v2cs.values(e))if(t.name=="__stay__"+e.name)return t;return o.hdconsole.assert(!1,"Variable's stay constraint does not exists"),null}planDirty(){return this.plan(this._dirty)}updateDirty(){this.planDirty(),this.executeDirty(),this._dirty.clear()}plan(e){let t=(0,l.join)((0,l.map)((e=>e.variables()),e)),r=this.gatherUpstreamConstraints(t),n=new Set,s=new Set,i=new l.BinaryHeap(((e,t)=>this.strength(e)>this.strength(t))),u=new a.default;for((0,l.forEach)((e=>{e.clearSelectedMethod(),e._initPruningData(),this.isMust(e)?(n.add(e),u.addConstraint(e)):i.push(e)}),r),o.hdconsole.assert(u.plan(),"no plan for must constraints");!i.empty();){let e=i.pop();switch(u.extendPlanIfPossible(e,s)){case!1:break;case!0:n.add(e),this._prune(e,n,s);break;case null:u.clear();for(let e of n)u.addConstraint(e);u.addConstraint(e),u.plan()?(n.add(e),this._prune(e,n,s)):(u.removeConstraint(e),e.clearSelectedMethod(),u.undoChangesAfterFailedPlan())}}return n}_prune(e,t,r){let n=new Set,s=Array.from(e._forcedVariables,(t=>e.i2v(t)));for(;s.length>0;){let e=s.pop();if(n.add(e),!r.has(e)){r.add(e);for(let r of this.constraints(e))if(r.isEnforced()&&t.has(r))for(let t of r._makeMethodsNonviableByVariable(e))n.has(t)||s.push(t)}}}solveFromConstraints(e){this.solve((0,l.join)((0,l.map)((e=>e.downstreamVariables()),e)))}solve(e){let t=[];for(let r of e){let e=this.getSourceConstraint(r);null!=e&&t.push(e)}let r=Array.from(this.gatherDownstreamConstraints(t)).reverse();for(let e of r)this.scheduleConstraint(e)}executeDirty(){let e=Array.from(this.gatherDownstreamConstraints(this._dirty)).reverse();for(let t of e)this.scheduleConstraint(t)}getSourceConstraint(e){for(let t of this._v2cs.values(e))if(t.isOutputVariable(e))return t;return null}scheduleConstraint(e){if(!e.isEnforced())return;let t=e.selectedMethod,r=Array.from(e.ins(t),(e=>e._activation)),n=[];(0,l.forEach)((e=>{n.push(e._activation),e.pushNewActivation()}),e.outs(t));let o=Array.from(e.outs(t),(e=>e._activation));new s.MethodActivation(t.code,t._promiseMask).execute(r,o),(0,l.forEach)((e=>(0,l.release)(e)),n)}scheduleCommand(e,t,r){let n=Array.from(e,(e=>e._activation)),o=Array.from(t),i=[];(0,l.forEach)((e=>{i.push(e._activation),e.pushNewActivation()}),o);let a=Array.from(o,(e=>e._activation));new s.MethodActivation(r,Array(n.length).fill(!1)).execute(n,a),(0,l.forEach)((e=>(0,l.release)(e)),i),o.forEach((e=>this.promoteVariable(e))),this.plan((0,l.map)((e=>this.getStay(e)),o)),this.solve(o)}}},779:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(775),s=(i(r(98)),i(r(916)),i(r(137)),i(r(831)),i(r(927)),r(292)),o=(i(r(894)),r(268));function i(e){return e&&e.__esModule?e:{default:e}}class a{prettyPrint(){let e="constraint "+this.name+" {\n";e+="  ";for(let t of this._varRefs)e+=t.prettyPrint()+"; ";return e+="\n",e+=this._cspec.prettyPrint("  ",this._varRefs),e+="}\n",e}substitute(e){return new a(this._owner,this._cspec,e,this._optional)}constructor(e,t,r,o=!1){this._owner=e,this._cspec=t,this._varRefs=[],this._vars=Array(t.nvars).fill(null),this._used=Array(t.nvars).fill(!0),this._danglingCount=t.nvars,this._optional=o,this._indices=new Map;let i=0;for(let e of r){n.hdconsole.assert((0,s.isOwnerOf)(e._owner,this._owner),`Constructing constraint ${this.name} with a foreign variable reference`),this._varRefs[i]=e;{let t=i;e.subscribe((e=>{if(null!==e){if(null!==this._vars[t]&&console.log("NOTNULL",this._vars[t]),this._vars[t]=e,this._indices.set(e,t),0==--this._danglingCount){let e=this.system;null!=e&&e.addConstraint(this)}}else{if(null===this._vars[t])return;if(0==this._danglingCount++){let e=this.system;null!=e&&e.removeConstraint(this)}this._indices.delete(this._vars[t]),this._vars[t]=null}}))}++i}this._initPruningData(),this.clearSelectedMethod()}equals(e){return this===e}get name(){return null==this._owner?"<unnamed>":this._owner.constraintName(this)}get owner(){return this._owner}get nvars(){return this._cspec.nvars}get system(){return this._owner.system}i2v(e){return this._vars[e]}v2i(e){return n.hdconsole.assert(this._indices.has(e),"unknown variable in Constraint.v2i: "+e.name),this._indices.get(e)}variables(){return this._vars}outs(e){return e.vOuts(this._vars)}ins(e){return e.vIns(this._vars)}nonOuts(e){return e.vNonOuts(this._vars)}methods(){return this._cspec.methods()}hasMethod(e){return this._cspec.hasMethod(e)}viableMethods(){return this._viableMethods}get selectedMethod(){return this._selectedMethod}set selectedMethod(e){n.hdconsole.assert(this._cspec.hasMethod(e),"selecting hotdrink.js method not in the constraint"),this._selectedMethod=e;for(let t of e.ins())this._used[t]=!0}clearSelectedMethod(){this._selectedMethod=null}isEnforced(){return null!=this._selectedMethod}isOutputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isOut(this.v2i(e))}isInputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isIn(this.v2i(e))}isNonOutputVariable(e){return null!=this.selectedMethod&&this.selectedMethod.isNonOut(this.v2i(e))}downstreamVariables(){return null==this.selectedMethod?(0,o.mkEmptyIterable)():this.selectedMethod.vOuts(this._vars)}downstreamAndUndetermined(){return null==this.selectedMethod?this._vars:this.selectedMethod.vOuts(this._vars)}upstreamVariables(){return null==this.selectedMethod?(0,o.mkEmptyIterable)():this.selectedMethod.vNonOuts(this._vars)}upstreamAndUndetermined(){return null==this.selectedMethod?this._vars:this.selectedMethod.vNonOuts(this._vars)}_initPruningData(){this._viableMethods=new Set,this._forcedVariables=new Set,this._outCounts=Array(this.nvars).fill(0);for(let e of this.methods()){this._viableMethods.add(e);for(let t of e.outs())this._outCounts[t]+=1}const e=this._viableMethods.size;for(let t=0;t<this.nvars;++t)this._outCounts[t]===e&&this._forcedVariables.add(t)}_makeMethodViable(e){n.hdconsole.assert(!this._viableMethods.has(e),"making hotdrink.js method viable twice"),n.hdconsole.assert(this.hasMethod(e),"unknown method");let t=this._viableMethods.size;this._viableMethods.add(e);let r=[];for(let t of e.outs())this._outCounts[t]+=1;for(let n of e.nonOuts())this._outCounts[n]===t&&(this._forcedVariables.delete(n),r.push(n));return r}_makeMethodNonviable(e){n.hdconsole.assert(this._viableMethods.has(e),"making hotdrink.js method nonviable twice"),n.hdconsole.assert(this._viableMethods.size>=2,"trying to make the last viable method nonviable"),this._viableMethods.delete(e);let t=this._viableMethods.size,r=[];for(let t of e.outs())this._outCounts[t]-=1;for(let n of e.nonOuts())this._outCounts[n]===t&&(this._forcedVariables.add(n),r.push(n));for(let e=0;e<this._outCounts.length;++e)n.hdconsole.assert(this._outCounts[e]>=0);return r}_makeMethodsNonviableByVariable(e){let t=this.v2i(e);if(this._forcedVariables.has(t))return(0,o.mkEmptyIterable)();let r=new Set;for(let e of(0,o.filter)((e=>e.isOut(t)),this._viableMethods))for(let t of(0,o.map)((e=>this.i2v(e)),this._makeMethodNonviable(e)))r.add(t);return r}}t.default=a},137:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(775),s=r(268);t.default=class{constructor(e,t,r,s,o,i){this._ins=new Set(t),this._outs=new Set(r);let a=Array.from(Array(e).keys());this._outs.forEach((e=>a[e]=null)),this._nonOuts=new Set;for(let e of a)null!=e&&this._nonOuts.add(e);this._promiseMask=Array.from(s),n.hdconsole.assert(this._ins.size===this._promiseMask.length,"Number of input arguments and length of promise mask must be the same"),this.code=o,null!=i&&(this._name=i)}get name(){return null==this._name?"":this._name}get nvars(){return this._outs.size+this._nonOuts.size}validIndex(e){return e>=0&&e<this.nvars}ins(){return this._ins}outs(){return this._outs}nonOuts(){return this._nonOuts}vIns(e){return(0,s.map)((t=>e[t]),this._ins)}vOuts(e){return(0,s.map)((t=>e[t]),this._outs)}vNonOuts(e){return(0,s.map)((t=>e[t]),this._nonOuts)}nIns(){return this._ins.size}nOuts(){return this._outs.size}nNonOuts(){return this._nonOuts.size}isIn(e){return this._ins.has(e)}isOut(e){return this._outs.has(e)}isNonOut(e){return this._nonOuts.has(e)}prettyPrint(e){let t=this.name+"(";for(const r of this._nonOuts)t+=e[r].name+" ";t+="->";for(const r of this._outs)t+=" "+e[r].name;return t+=");",t}}},986:(__unused_webpack_module,exports,__webpack_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.variableToJson=variableToJson,exports.methodToJson=methodToJson,exports.methodFromJson=methodFromJson,exports.constraintSpecToJson=constraintSpecToJson,exports.constraintSpecFromJson=constraintSpecFromJson,exports.componentToJson=componentToJson,exports.componentFromJson=componentFromJson,exports.constraintToJson=constraintToJson,exports.constraintFromJson=constraintFromJson,exports.constraintSystemToJson=constraintSystemToJson,exports.constraintSystemFromJson=constraintSystemFromJson;var _method=_interopRequireDefault(__webpack_require__(137)),_component=_interopRequireDefault(__webpack_require__(894)),_constraintSpec=_interopRequireDefault(__webpack_require__(916)),_constraint=_interopRequireDefault(__webpack_require__(779)),_constraintSystem=_interopRequireDefault(__webpack_require__(98)),_constraintSystemUtil=__webpack_require__(292);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function variableToJson(e,t){var r,n;return{name:e,value:null===(r=t.getVariableReference(e))||void 0===r||null===(n=r.value)||void 0===n?void 0:n.value}}function methodToJson(e){return{name:e._name,nvars:e.nvars,ins:Array.from(e._ins),outs:Array.from(e._outs),code:e.code.toString(),promiseMask:Array.from(e._promiseMask)}}function methodFromJson(method){return new _method.default(method.nvars,method.ins,method.outs,method.promiseMask.map(_constraintSystemUtil.toMask),eval(method.code),method.name)}function constraintSpecToJson(e){return{methods:Array.from(e._methods).map(methodToJson)}}function constraintSpecFromJson(e){return new _constraintSpec.default(e.methods.map(methodFromJson))}function componentToJson(e,t){return{name:e._name,variables:Array.from(e._varRefs.keys()).map((t=>variableToJson(t,e))),constraints:t}}function componentFromJson(e){let t=new _component.default(e.name);return e.variables.forEach((e=>{t.emplaceVariable(e.name,e.value)})),e.constraints.forEach((e=>{constraintFromJson(e,t)})),t}function constraintToJson(e,t){return{name:t,constraintSpec:constraintSpecToJson(e._cspec),optional:e._optional}}function constraintFromJson(e,t){return t.emplaceConstraint(e.name,constraintSpecFromJson(e.constraintSpec),t._varRefs.values(),e.optional)}function constraintSystemToJson(e){let t=new Map;Array.from(e._musts).forEach((e=>{var r;t.set(e.owner,[e,...null!==(r=t.get(e.owner))&&void 0!==r?r:[]])}));const r={components:Array.from(t.keys()).map((e=>{var r;const n=(null!==(r=t.get(e))&&void 0!==r?r:[]).map((t=>{var r;return constraintToJson(t,null!==(r=e.constraintName(t))&&void 0!==r?r:"")}));return componentToJson(e,n)}))};return JSON.stringify(r)}function constraintSystemFromJson(e){const t=JSON.parse(e),r=new _constraintSystem.default;return t.components.forEach((e=>{r.addComponent(componentFromJson(e))})),r}},341:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,o(r(927)),o(r(779)),o(r(137));var n=r(775),s=r(268);function o(e){return e&&e.__esModule?e:{default:e}}t.default=class{constructor(){this._v2cs=new s.OneToManyMap,this._freeVars=new Set,this._forcedByPlan=new Map,this._changeList=[]}addConstraint(e){for(let t of e.variables())switch(this._v2cs.add(t,e),this._v2cs.count(t)){case 1:this._freeVars.add(t);break;case 2:this._freeVars.delete(t)}}removeConstraint(e){for(let t of e.variables())switch(this._v2cs.remove(t,e),this._v2cs.count(t)){case 0:this._freeVars.delete(t),this._v2cs.removeKey(t);break;case 1:this._freeVars.add(t)}}clear(){this._v2cs.clear(),this._freeVars.clear()}plan(){let e=!0;for(;e;){e=!1;for(let[t,r]of this.freeMethods()){e=!0;let n=t.selectedMethod;if(n!==r&&null!=n){this._changeList.push([t,n]);for(let e of t.outs(n))this._forcedByPlan.delete(e)}t.selectedMethod=r;for(let e of t.outs(r))this._forcedByPlan.set(e,r);this.removeConstraint(t)}}return 0===this._v2cs.countKeys()&&(this._changeList=[],!0)}undoChangesAfterFailedPlan(){for(let[e,t]of this._changeList){let r=e.selectedMethod;if(null!=r)for(let t of e.outs(r))this._forcedByPlan.delete(t);for(let r of e.outs(t))this._forcedByPlan.set(r,t);e.selectedMethod=t}}extendPlanIfPossible(e,t){if((0,s.every)((r=>(0,s.some)((e=>t.has(e)),e.outs(r))),e._viableMethods))return!1;if((0,s.every)((e=>!this._forcedByPlan.has(e)),e.variables())){let t=(0,s.first)(e._viableMethods);if(n.hdconsole.assert(null!=t,"constraint has no viable methods"),null==t)return!1;e.selectedMethod=t;for(let r of e.outs(t))this._forcedByPlan.set(r,t);return!0}return null}*freeMethods(){let e=new Set;for(let t of this._freeVars)for(let r of this._v2cs.values(t))if(!e.has(r)){e.add(r);for(let e of r.viableMethods())if((0,s.every)((e=>this._freeVars.has(e)),r.outs(e))){yield[r,e];break}}}firstFreeMethod(){return(0,s.first)(this.freeMethods())}constraints(){let e=new Set;for(let t of this._v2cs.keys())for(let r of this._v2cs.values(t))e.add(r);return e}}},391:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpstreamSolutionGraph=t.DownstreamSolutionGraph=void 0,o(r(779)),o(r(927)),o(r(98));var n=r(292),s=r(268);function o(e){return e&&e.__esModule?e:{default:e}}t.DownstreamSolutionGraph=class{constructor(e){this._system=e}adjacentOutVertices(e){return(0,n.isConstraint)(e)?e.downstreamAndUndetermined():(0,s.filter)((t=>t.isNonOutputVariable(e)||!t.isEnforced()),this._system._v2cs.values(e))}outDegree(e){return(0,n.isConstraint)(e)?null!=e.selectedMethod?e.selectedMethod.nOuts():0:(0,s.count)(this.adjacentOutVertices(e))}},t.UpstreamSolutionGraph=class{constructor(e){this._system=e}adjacentOutVertices(e){return(0,n.isConstraint)(e)?e.upstreamAndUndetermined():(0,s.filter)((t=>t.isOutputVariable(e)||!t.isEnforced()),this._system._v2cs.values(e))}outDegree(e){return(0,n.isConstraint)(e)?null!=e.selectedMethod?e.selectedMethod.nNonOuts():0:(0,s.count)(this.adjacentOutVertices(e))}}},831:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,s(r(894)),s(r(98)),s(r(927));var n=r(268);function s(e){return e&&e.__esModule?e:{default:e}}class o extends n.ObservableReference{constructor(e){super(),this._owner=e}get system(){return this._owner.system}get name(){return this._owner.variableReferenceName(this)}isOwningReference(){return null!=this.value&&this.value._owner===this}prettyPrint(){let e=this.name;return null!=this.value&&(e+=":"+this.value._index),e}}t.default=o},927:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(329),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}(r(534)),o=(i(r(831)),i(r(98)),r(268));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}let u=(()=>{let e=0;return()=>++e})();t.default=class{get value(){return this._inError?void 0:this._value}get error(){return this._inError?this._error:void 0}get stale(){return!this._pending&&this._inError}get pending(){return this._pending}constructor(e,t){this._index=u(),this._owner=e,this._value=void 0,this._error=void 0,this._inError=!1,this._pending=!0,this._subject=new s.Subject((e=>{let t={value:this._value,pending:this._pending,inError:this._inError};this._inError&&(t.error=this._error),e.next(t)})),this.pushNewActivation(),void 0!==t&&this._activation.resolve(t)}subscribe(e){return this._subject.subscribe(e)}subscribeValue(e){return this._subject.filter((e=>e.hasOwnProperty("value"))).map((e=>e.value)).subscribe(e)}subscribePending(e){return this._subject.filter((e=>e.hasOwnProperty("pending"))).map((e=>e.pending)).subscribe(e)}subscribeError(e){return this._subject.filter((e=>e.hasOwnProperty("inError")||e.hasOwnProperty("error"))).map((e=>{let t={};return e.hasOwnProperty("error")&&(t.error=e.error),e.hasOwnProperty("inError")&&(t.inError=e.inError),t})).subscribe(e)}pushNewActivation(){let e=new n.VariableActivation(this);return this._activation=e,!1===this._pending&&(this._pending=!0,this._subject.sendNext({pending:!0})),e.promise.then((t=>{if(e===this._activation){this._value=t;let e={value:t};this._inError&&(this._inError=!1,e.inError=!1),this._pending=!1,e.pending=!1,this._subject.sendNext(e)}}),(t=>{if(e===this._activation){this._error=t;let e={error:t};this._inError||(this._inError=!0,e.inError=!0),this._pending=!1,e.pending=!1,this._subject.sendNext(e)}})),e}get currentPromise(){return this._activation.promise}get owner(){return this._owner}get system(){return this._owner.system}get name(){return null==this._owner?"<unnamed>":this._owner.name}set(e){this.assign(e);let t=this.system;return null!=t&&t.updateDirty(),this}fail(e){this._assign().reject(e);let t=this.system;return null!=t&&t.updateDirty(),this}assign(e){this._assign().resolve(e)}_assign(){let e=this._activation;this.pushNewActivation();let t=this.system;if(null!=t){t.promoteVariable(this);let e=t.getSourceConstraint(this);null!=e&&t.setDirty(e),t.setDirty(t.getStay(this))}return(0,o.release)(e),this._activation}touch(){let e=this.system;return null!=e&&e.promoteVariable(this),this}_touchPlanSolve(){this.touch();let e=this.system,t=this._activation;if(this.pushNewActivation(),null==e)return(0,o.release)(t),this._activation;let r=this._activation,n=e.getSourceConstraint(this);return e.setDirty(null!=n?n:e.getStay(this)),e.updateDirty(),(0,o.release)(t),r}}},17:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reverseTopoSort=function(e){return i(e,e.vertices())},t.reverseTopoSortFrom=i,t.dfsVisit=s;var n=r(268);function s(e,t,r,s){null==s&&(s=new Set);let o=[],i=(0,n.iterableToIterator)(t);for(;;){let t=i.next();if(t.done){if(0===o.length)break;let e;[e,i]=o.pop(),r.finishVertex(e);continue}let a=t.value;s.has(a)||(r.discoverVertex(a),s.add(a),o.push([a,i]),i=(0,n.iterableToIterator)(e.adjacentOutVertices(a)))}}class o{constructor(){this.result=[]}discoverVertex(e){}finishVertex(e){this.result.push(e)}}function i(e,t){let r=new o;return s(e,t,r),r.result}},775:(e,t)=>{function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.HdError=t.default=t.hdconsole=t.HdConsole=void 0;class n{constructor(e){r(this,"error",console.error),r(this,"assert",console.assert),this._name=e,this.on()}off(){this.log=(...e)=>{},this.warn=(...e)=>{},this.error=(...e)=>{},this.assert=(e,...t)=>{}}errorsOnly(){this.off(),this.error=console.error,this.assert=console.assert}on(){this.log=console.log,this.warn=console.warn,this.error=console.error,this.assert=console.assert}}t.HdConsole=n;const s=new n("HotDrink");t.hdconsole=s;var o={hdconsole:s};t.default=o;class i extends Error{constructor(e,...t){super(e,...t),Error.captureStackTrace&&Error.captureStackTrace(this,i),this.name="HdError"}}t.HdError=i},707:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n={defaultConstraintSystem:!0,constraintSystemInVisNodesAndEdges:!0,constraintSystemInVisAllNodesAndEdges:!0,ConstraintSystem:!0,Method:!0,component:!0,hdl:!0,hdconsole:!0,maskPromiseUpdate:!0,maskUpdate:!0,maskPromise:!0,maskNone:!0,MaskType:!0,Component:!0,Constraint:!0,ConstraintSpec:!0,Variable:!0,VariableReference:!0,SimplePlanner:!0};t.constraintSystemInVisNodesAndEdges=function(e){let t=[],r=[];for(let r of e.variables())t.push({id:y(r),label:r.name,shape:"box"});for(let n of e.allConstraints()){let e=0;if(!n.isEnforced())continue;let s=n.selectedMethod,o=`m#${y(n)}-${e}`;console.log("ID: ",o,"C.M",n.name+"."+s.name);let i="lime";t.push({id:o,label:n.name+"."+s.name,cid:"C#"+y(n),color:i});for(let e of n.nonOuts(s))r.push({from:y(e),to:o,arrows:"to",dashes:!0});for(let e of n.outs(s))r.push({from:o,to:y(e),arrows:"to"});++e}return[t,r]},t.constraintSystemInVisAllNodesAndEdges=function(e){let t=[],r=[];for(let r of e.variables())t.push({id:y(r),label:r.name,shape:"box"});for(let n of e.allConstraints()){let e=0;for(let s of n.methods()){let o=`m#${y(n)}-${e}`;console.log("ID: ",o,"C.M",n.name+"."+s.name);let i="lime";t.push({id:o,label:n.name+"."+s.name,cid:"C#"+y(n),color:i});for(let e of n.nonOuts(s))r.push({from:y(e),to:o,arrows:"to",dashes:!0}),console.log("INS: ",e.name);for(let e of n.outs(s))r.push({from:o,to:y(e),arrows:"to"}),console.log("OUTS: ",e.name);++e}}return[t,r]},Object.defineProperty(t,"ConstraintSystem",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Method",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"component",{enumerable:!0,get:function(){return i.component}}),Object.defineProperty(t,"hdl",{enumerable:!0,get:function(){return i.hdl}}),Object.defineProperty(t,"hdconsole",{enumerable:!0,get:function(){return a.hdconsole}}),Object.defineProperty(t,"maskPromiseUpdate",{enumerable:!0,get:function(){return l.maskPromiseUpdate}}),Object.defineProperty(t,"maskUpdate",{enumerable:!0,get:function(){return l.maskUpdate}}),Object.defineProperty(t,"maskPromise",{enumerable:!0,get:function(){return l.maskPromise}}),Object.defineProperty(t,"maskNone",{enumerable:!0,get:function(){return l.maskNone}}),Object.defineProperty(t,"MaskType",{enumerable:!0,get:function(){return l.MaskType}}),Object.defineProperty(t,"Component",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"Constraint",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"ConstraintSpec",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(t,"Variable",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(t,"VariableReference",{enumerable:!0,get:function(){return _.default}}),Object.defineProperty(t,"SimplePlanner",{enumerable:!0,get:function(){return m.default}}),t.defaultConstraintSystem=void 0;var s=v(r(98)),o=v(r(137)),i=r(230),a=r(775),u=r(391);Object.keys(u).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===u[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}}))}));var l=r(292);Object.keys(l).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===l[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}}))}));var c=r(986);Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===c[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var h=v(r(894)),f=v(r(779)),d=v(r(916)),p=v(r(927)),_=v(r(831)),m=v(r(341));function v(e){return e&&e.__esModule?e:{default:e}}const b=new s.default;t.defaultConstraintSystem=b;let y=(()=>{let e=new WeakMap,t=0;return r=>{let n=e.get(r);if(void 0!==n)return n;{let n=t++;return e.set(r,n),n}}})()},877:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isWhitespace=function(e){switch(e){case" ":case"\t":case"\r":case"\n":return!0;default:return!1}},t.isDigit=n,t.isAlpha=s,t.isAlphaPlus=o,t.isAlphaNum=function(e){return o(e)||n(e)},t.Position=void 0;class r{constructor(e,t,r,n){this._pos=e,this._row=t,this._col=r,void 0!==n&&(this._source=n)}get pos(){return this._pos}get row(){return this._row}get col(){return this._col}get source(){return null!=this._source?this._source:"-"}toString(){return this.source+":"+this.row+":"+this.col}advance(e){for(let t=0;t<e.length;++t)"\n"===e[t]?(this._row++,this._col=0):this._col++,this._pos++}clone(){let e=new r(this.pos,this.row,this.col);return this.hasOwnProperty("_source")&&(e._source=this._source),e}}function n(e){return e>="0"&&e<="9"}function s(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}function o(e){return s(e)||"_"===e||"$"===e}t.Position=r},534:(e,t)=>{function r(e,t,r){if("function"==typeof e){let n={};return n.next=e,null!=t&&(n.error=t),null!=r&&(n.complete=r),n}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.mkObserver=r,t.BehaviorSubject=t.ReplaySubject=t.Subject=t.SubscriptionObserver=t.HdSubscription=t.Observable=void 0;class n{constructor(e){this._subscriber=e}subscribe(e,t,n){let i=r(e,t,n),a=new s(i);try{null!=i.start&&i.start(a)}catch(e){}if(a.closed)return a;let u=new o(a);try{let e=this._subscriber(u);"object"==typeof e&&(e=()=>e.unsubscribe()),a._cleanup=e}catch(e){u.error(e)}return a.closed&&a.cleanup(),a}static of(...e){return new n((t=>{for(let r of e)if(t.next(r),t.closed)return;t.complete()}))}filter(e){return new n((t=>{let n=r(t);return null==n.next&&(n={next:e=>{}}),this.subscribe((t=>{1==e(t)&&n.next(t)}))}))}map(e){return new n((t=>{let n=r(t);return null==n.next&&(n={next:e=>{}}),this.subscribe((n=>{r(t).next(e(n))}))}))}}t.Observable=n;class s{constructor(e){this._observer=e,this._cleanup=void 0}unsubscribe(){this._observer=void 0,this.cleanup()}get closed(){return void 0===this._observer}cleanup(){const e=this._cleanup;if(void 0!==e){this._cleanup=void 0;try{e()}catch(e){}}}}t.HdSubscription=s;class o{constructor(e){this._subscription=e}get closed(){return this._subscription.closed}next(e){let t=this._subscription;if(!t.closed&&null!=t._observer.next)try{t._observer.next(e)}catch(e){}}error(e){let t=this._subscription;if(!t.closed){if(null!=t._observer.error)try{t._observer.error(e)}catch(e){}this._subscription.cleanup()}}complete(){let e=this._subscription;if(!e.closed){if(null!=e._observer.complete)try{e._observer.complete()}catch(e){}this._subscription.cleanup()}}}t.SubscriptionObserver=o;class i extends n{constructor(e=(e=>{})){let t={observers:new Set,done:!1};super((r=>(t.done||t.observers.add(r),e(r),()=>t.observers.delete(r)))),this._subjectState=t}sendNext(e){if(!this._subjectState.done)for(const t of this._subjectState.observers)t.next(e)}sendError(e){if(!this._subjectState.done){this._subjectState.done=!0;for(const t of this._subjectState.observers)t.error(e)}}sendComplete(){if(!this._subjectState.done){this._subjectState.done=!0;for(const e of this._subjectState.observers)e.complete()}}get nObservers(){return this._subjectState.observers.size}}t.Subject=i;class a extends i{constructor(e=1){let t={past:[],pastLimit:e,isCompleted:!1,isError:!1};super((e=>{for(let r of t.past)e.next(r);t.isError?e.error(t.error):t.isCompleted&&e.complete()})),this._replaySubjectState=t}sendNext(e){this._replaySubjectState.past.push(e),this._replaySubjectState.past.length>this._replaySubjectState.pastLimit&&this._replaySubjectState.past.shift(),super.sendNext(e)}sendError(e){this._replaySubjectState.isError=!0,this._replaySubjectState.error=e,super.sendError(e)}sendComplete(){this._replaySubjectState.isCompleted=!0,super.sendComplete()}}t.ReplaySubject=a,t.BehaviorSubject=class extends a{constructor(e){super(1),this._replaySubjectState.past.push(e)}}},316:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mkParseState=c,t.ok=h,t.fail=f,t.failF=d,t.item=_,t.peekItem=m,t.failure=function(e){return f([])},t.ret=v,t.eof=b,t.sat=y,t.pChar=g,t.pChars=function(e){return y((t=>(0,i.some)((e=>e===t),e)),`<any of '${e}'>`)},t.many=M,t.many1=x,t.exactString=O,t.pBind=E,t.pBind_=V,t.opt=function(e,t){return r=>{r.checkpoint();let n=e(r);return n.success?(r.forgetCheckpoint(),h(n.value,n.consumed)):(r.resetCheckpoint(),h(t,!1))}},t.ignore=function(e){return A((()=>T),e)},t.lift=A,t.lift2=function(e){return(t,r)=>A(e,t,r)},t.lift3=function(e){return(t,r,n)=>A(e,t,r,n)},t.lift4=function(e){return(t,r,n,s)=>A(e,t,r,n,s)},t.lift5=function(e){return(t,r,n,s,o)=>A(e,t,r,n,s,o)},t.go=D,t.inBetween=R,t.parens=function(e){return R(e,U("("),U(")"))},t.oneOf=I,t.pNot=z,t.until=function(e){return A((e=>e.join("")),M(V(z(e),_)))},t.notFollowedBy=F,t.pTry=function(e){return t=>{t.checkpoint();let r=e(t);return r.success?(t.forgetCheckpoint(),r):(t.resetCheckpoint(),f([e.parserName]))}},t.must=function(e,t){return r=>{let n=e(r);if(n.success)return n;throw r.parseErrorF(n.expecting,t)}},t.named=J,t.token=B,t.word=U,t.keyword=function(e){return J(B(F(O(e),J(k,"<alphanum>"))),`<keyword: ${e}>`)},t.identifier=function(e){return A(((e,t,r)=>e+t.join("")),y(s.isAlphaPlus,"<identifier>"),M(y(s.isAlphaNum)),N)(e)},t.sepList=function(e,t){return r=>{let n=e(r);if(!n.success)return n.consumed?n:h([],!1);let s=M(V(t,e))(r);return s.consumed=n.consumed||s.consumed,s.success&&s.value.unshift(n.value),s}},t.context=function(e,t){return r=>{r.pushContext(e);try{return t(r)}finally{r.popContext()}}},t.hdl=function(e,...t){let r="";for(let n=0;n<t.length;++n)r+=e[n],r+="###"+n+"###";return e.length>0&&(r+=e[e.length-1]),c(r,t)},t.pSplice=t.currentPos=t.nat=t.manyws=t.onews=t.blockComment=t.lineComment=t.digit=t.alphaNum=t.alphaPlus=t.ParseError=t.ParseState=void 0;var n,s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=u(t);if(r&&r.has(e))return r.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}(r(877)),o=(n=r(738))&&n.__esModule?n:{default:n},i=r(268),a=r(775);function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(u=function(e){return e?r:t})(e)}class l{constructor(e,t=[],r=new s.Position(0,1,0)){this._input=new o.default(e),this._context=[],this._splices=t,this.pos=r}pushContext(e){this._context.push([e,this.pos.clone()])}popContext(){this._context.pop()}checkpoint(){this._input.checkpoint(this.pos.clone())}forgetCheckpoint(){this._input.forgetCheckpoint()}resetCheckpoint(){this.pos=this._input.reset()}peek(){return this._input.peek()}advance(){let e=this._input.next();return e.done||this.pos.advance(e.value),e.value}getSplice(e){return this._splices[e]}parseErrorF(e,t){let r,n;this._context.length>0&&([r,n]=this._context[this._context.length-1]),this.checkpoint();let o=A(((e,t)=>e+t.join("")),N,M(y((e=>!s.isWhitespace(e)),"")))(this);this.resetCheckpoint();let i="<?>";return o.success&&(i=o.value),new p(this.pos.clone(),e,i,r,n,t)}parseError(e,t){return this.parseErrorF((()=>e),t)}}function c(e,t=[]){return new l(e[Symbol.iterator](),t)}function h(e,t=!0){return{success:!0,value:e,consumed:t}}function f(e,t=!1){return d((()=>e),t)}function d(e,t=!1){return{success:!1,expecting:e,consumed:t}}t.ParseState=l;class p extends Error{constructor(e,t,r,n,s,o){super(),this._pos=e,this._expecting=t,this._unexpected=r,this._ctxName=n,this._ctxPos=s,this._msg=o}get name(){return"HotDrink Parse Error"}set name(e){throw Error("Cannot set the name of ParseError")}get message(){let e=this._pos.toString()+"\n";null!=this._msg&&(e+=this._msg+"\n");let t=this._formatExpecting();return""!==t&&(e+="Expecting "+t+". "),e+="Unexpected "+(null!=this._unexpected?this._unexpected:"<eof>")+"\n",null!=this._ctxName&&null!=this._ctxPos&&(e+="\n  while parsing "+this._ctxName+" ("+this._ctxPos.toString()+")\n"),e}set message(e){throw Error("Cannot set the message of ParseError")}_formatExpecting(){let e=this._expecting();return 1==e.length?e[0]:e.length>1?"one of ("+e.join(", ")+")":""}}function _(e){let t=e.advance();return null==t?f(["<item>"]):h(t)}function m(e){let t=e.peek();return null==t?f(["<peek-item>"]):h(t,!1)}function v(e,t=!1){return r=>h(e,t)}function b(e){return m(e).success?f(["<eof>"]):h(null,!1)}function y(e,t="<sat: ?>"){let r=r=>{let n=m(r);return n.success&&e(n.value)?_(r):f([t])};return r.parserName=t,r}function g(e){return y((t=>t===e),e)}t.ParseError=p;const w=y(s.isAlphaPlus,"<letter>");t.alphaPlus=w;const k=y(s.isAlphaNum,"<letter or digit>");t.alphaNum=k;const S=y(s.isDigit,"<digit>");function M(e){return I(x(e),v([]))}function x(e){return t=>A(((e,t)=>(t.unshift(e),t)),e,M(e))(t)}function O(e){let t=t=>{t.checkpoint();for(let r of e){let n=_(t);if(n.success&&n.value!=r||!n.success)return t.resetCheckpoint(),f([e])}return t.forgetCheckpoint(),h(e,e.length>0)};return t.parserName=e,t}t.digit=S;const P=A(((e,t,r)=>e+t.join("")+r),O("//"),M(y((e=>"\n"!==e))),I(g("\n"),V(b,v(""))));t.lineComment=P;const C=A(((e,t,r)=>e+t.join("")+r),O("/*"),M(V(z(O("*/")),_)),I(O("*/"),V(b,v(""))));t.blockComment=C;const j=y(s.isWhitespace,"<whitespace>");t.onews=j;const N=A((e=>e.join("")),M(I(j,P,C)));function E(e,t){return r=>{const n=e(r);if(!n.success)return n;let s=t(n.value)(r);return s.consumed||(s.consumed=n.consumed),s}}function V(e,t){return E(e,(e=>t))}t.manyws=N;const T={};function A(e,...t){return r=>{let n=[],s=!1;for(let e of t){let t=e(r);if(t.consumed=t.consumed||s,s=t.consumed,!t.success)return t;t.value!==T&&n.push(t.value)}return h(e(...n))}}function D(e){return function(t){let r=!1,n=e.next();for(;!n.done;){let s=n.value(t);if(s.consumed=s.consumed||r,r=s.consumed,!s.success)return s;n=e.next(s.value)}return void 0===n.value?(a.hdconsole.assert(!1,"Incorrect yield parser"),f(["<?>"],r)):h(n.value,r)}}function R(e,t,r){return D(function*(){yield t;const n=yield e;return yield r,n}())}function I(...e){return t=>{let r=[];for(let n of e){let e=n(t);if(e.success||e.consumed)return e;r.push(e.expecting)}return d((()=>Array.prototype.concat(...r.map((e=>e())))))}}function z(e){return t=>{t.checkpoint();let r=e(t);if(!r.success&&!r.consumed)return t.resetCheckpoint(),h(null,!1);let n=r.consumed;return r.success?(t.resetCheckpoint(),n=!1):t.forgetCheckpoint(),f(["not("+e.parserName+")"],n)}}function F(e,t){return r=>{r.checkpoint();let n=e(r);if(!n.success)return r.forgetCheckpoint(),n;let s=z(t)(r);return s.success?(r.forgetCheckpoint(),n):s.consumed?(r.forgetCheckpoint(),s):(r.resetCheckpoint(),f([e.parserName+" not followed by "+t.parserName]))}}function J(e,t="<?>"){let r=r=>{let n=e(r);return n.success||(n.expecting=()=>[t]),n};return r.parserName=t,r}function B(e){return A(((e,t)=>e),e,N)}function U(e){return B(O(e))}let q=A((e=>Number(e.join(""))),J(B(F(J(x(S),"<nat>"),J(w,"<alphaplus>"))),"<nat>"));t.nat=q,t.currentPos=e=>h(e.pos.clone(),!1),t.pSplice=e=>E(R(q,O("###"),U("###")),(t=>v(e.getSplice(t))))(e)},738:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=class{constructor(e){this._iter=e,this._currentIndex=0,this._firstIndex=0,this._buffer=[],this._checkpoints=[]}next(){if(0===this._fetch(1))return{done:!0};let e={value:this._at(this._currentIndex++),done:!1};return this._collect(),e}_ind2buf(e){return e-this._firstIndex}_at(e){return this._buffer[this._ind2buf(e)]}_fetch(e){let t=e-(this._buffer.length-this._ind2buf(this._currentIndex));for(;t>0;){let e=this._iter.next();if(e.done)break;t--,this._buffer.push(e.value)}return e-t}_collect(){let e=0===this._checkpoints.length?this._currentIndex-this._firstIndex:this._checkpoints[0].index-this._firstIndex;this._firstIndex+=e,this._buffer.splice(0,e)}checkpoint(e){this._checkpoints.push({index:this._currentIndex,value:e})}forgetCheckpoint(){if(void 0===this._checkpoints.pop())throw"Trying to forget hotdrink.js nonexisting checkpoint in PeekIterator";this._collect()}reset(){if(0===this._checkpoints.length)throw"Trying to reset to hotdrink.js nonexisting checkpoint in PeekIterator";let e=this._checkpoints.pop();return this._currentIndex=e.index,this._collect(),e.value}peek(){return this._fetch(1),this._at(this._currentIndex)}peekMany(e){return this._fetch(e),this._buffer.slice(this._ind2buf(this._currentIndex),this._ind2buf(this._currentIndex+e))}}},268:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.equals=i,t.orderedSetEquals=a,t.orderedMapEquals=u,t.setEquals=function(e,t){if(e.size!==t.size)return!1;for(let r of e.keys())if(!t.has(r))return!1;return!0},t.mapEquals=function(e,t){if(e.size!==t.size)return!1;for(let[r,n]of e)if(!i(t.get(r),n))return!1;return!0},t.copy=function e(t){return function(t){if(Array.isArray(t))return t.map((t=>e(t)));if(t instanceof Set)return new Set(t);if(t instanceof Map)return new Map(p((([t,r])=>[t,e(r)]),t));if("object"==typeof t&&null!==t){if("function"==typeof t.copy)return t.copy();{let r=Object.create(Object.getPrototypeOf(t));for(let n of Object.keys(t))r[n]=e(t[n]);return r}}return"function"==typeof t&&"function"==typeof t.copy?t.copy():t}(t)},t.subsetOf=function(e,t){for(let r of e.keys())if(!t.has(r))return!1;return!0},t.modifyMapValue=l,t.setUnion=function(e,t){let r=new Set;return c(r,e),c(r,t),r},t.setUnionTo=c,t.setUnionToWithDiff=function(e,t){let r=new Set;for(let n of t)e.has(n)||(e.add(n),r.add(n));return r},t.setDifference=function(e,t){let r=new Set;for(let n of e)t.has(n)||r.add(n);return r},t.setDifferenceTo=function(e,t){for(let r of t)e.delete(r)},t.mkEmptyIterable=h,t.mkSingletonIterable=function*(e){yield e},t.mkEmptyIterator=function(){return{next:()=>({done:!0,value:void 0})}},t.iteratorToIterable=f,t.iterableToIterator=d,t.map=p,t.filter=function(e,t){return{[Symbol.iterator]:()=>{const r=t[Symbol.iterator]();let n={next:()=>{let t,n=!1;do{({done:n,value:t}=r.next())}while(!n&&!e(t));return{done:n,value:t}}};return"function"==typeof r.return&&(n.return=e=>r.return(e)),"function"==typeof r.throw&&(n.throw=e=>r.throw(e)),n}}},t.until=function(e,t){return{[Symbol.iterator]:()=>{const r=t[Symbol.iterator]();let n={},s=()=>r.next();return n.done=!1,n.next=()=>{if(n.done)return{done:!0};let{done:t,value:o}=s();return s=()=>r.next(),t?(n.done=!0,{done:!0}):(t=e(o),t?("function"==typeof r.return&&r.return(),{done:!0}):{done:!1,value:o})},"function"==typeof r.return&&(n.return=e=>r.return(e)),"function"==typeof r.throw&&(n.throw=e=>(s=()=>r.throw(e),n.next())),n}}},t.every=function(e,t){for(let r of t)if(!e(r))return!1;return!0},t.some=function(e,t){for(let r of t)if(e(r))return!0;return!1},t.forEach=function(e,t){for(let r of t)e(r);return e},t.adjacentFind=_,t.isSortedBy=function(e,t){return null===_(((t,r)=>!e(t,r)),t)},t.count=function(e){let t=0;for(let r of e)++t;return t},t.first=function(e){const t=e[Symbol.iterator]();let r=t.next();return r.done?void 0:("function"==typeof t.return&&t.return(),r.value)},t.firstKeepOpen=function(e){let t=e[Symbol.iterator]().next();return t.done?void 0:t.value},t.rest=function(e){let t=d(e);return t.next(),f(t)},t.foldl=function(e,t,r){let n=t;for(let t of r)n=e(t,n);return n},t.join=function(e){return{[Symbol.iterator]:()=>{let t,r=d(e),n=!0,s=!1;return{next:()=>{if(s)return{done:!0};let e,o;for(;;){if(1==n){if(e=r.next(),e.done)return{done:!0};t=d(e.value)}if(o=t.next(),!o.done)return n=!1,{done:!1,value:o.value};n=!0}},return:e=>(s||(s=!0,n||"function"!=typeof t.return||t.return(e)),{done:!0,value:e}),throw:e=>{if(s)throw e}}}}},t.zipWith=m,t.zip=function(e,t){return m(((e,t)=>[e,t]),e,t)},t.bisimilar=function(e,t){return b(((e,t)=>i(e,t)),e,t)},t.bisame=v,t.every2=b,t.sameElements=function(e,t){let r=new Map;for(let t of e)l(r,t,(e=>null==e?1:e+1));for(let e of t){let t=r.get(e);if(1===t)r.delete(e);else{if(void 0===t)return!1;r.set(e,t-1)}}return 0===r.size},t.mkRefCounted=function(e,t,r){return n.hdconsole.assert(0===S(e),"trying to make an object reference counted twice"),g.set(e,t),null!=r&&w.set(e,r),y.set(e,1),e},t.setUniqueHandler=function(e,t){w.set(e,t)},t.retain=function(e){let t=y.get(e);return null==t?(n.hdconsole.assert(null!=t,"trying to retain hotdrink.js non-refcounted object"),y.set(e,NaN)):y.set(e,t+1),e},t.release=k,t.refCount=S,t.isUnique=function(e){return 1===S(e)},t.throw_on_null=function(e){if(null==e)throw"Expected non-null";return e},t.nonnull_cast=function(e){return e},t.BinaryHeap=t.ObservableReference=t.PriorityList=t.LinkedList=t.ListNode=t.RefListNode=t.RefList=t.OneToManyMap=void 0;var n=r(775),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&Object.prototype.hasOwnProperty.call(e,i)){var a=s?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}(r(534));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}function i(e,t){if((e=e)===(t=t))return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!i(e[r],t[r]))return!1;return!0}if(e instanceof Set&&t instanceof Set)return a(e,t);if(e instanceof Map&&t instanceof Map)return u(e,t);if("object"==typeof e&&null!==e){if("function"==typeof e.equals)return e.equals(t);if(null!=t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let n of r)if(!i(e[n],t[n]))return!1;return!0}}return"function"==typeof e&&"function"==typeof e.equals&&e.equals(t)}function a(e,t){return e.size===t.size&&v(e,t)}function u(e,t){return e.size===t.size&&b((([e,t],[r,n])=>e===r&&i(t,n)),e,t)}function l(e,t,r){let n=r(e.get(t));return e.set(t,n),n}function c(e,t){for(let r of t)e.add(r)}function*h(){}function f(e){let t={};return t[Symbol.iterator]=function(){return e},t}function d(e){return e[Symbol.iterator]()}function p(e,t){return{[Symbol.iterator]:()=>{const r=t[Symbol.iterator]();let n={next:()=>{const{done:t,value:n}=r.next();return{done:t,value:t?void 0:e(n)}}};return"function"==typeof r.return&&(n.return=e=>r.return(e)),"function"==typeof r.throw&&(n.throw=e=>r.throw(e)),n}}}function _(e,t){let r=d(t),n=r.next();if(n.done)return null;let s=n.value;for(;;){let t=r.next();if(t.done)return null;if(e(s,t.value))return"function"==typeof r.return&&r.return(),[s,t.value];s=t.value}}function m(e,t,r){let n=!1;return{[Symbol.iterator]:()=>{const s=t[Symbol.iterator](),o=r[Symbol.iterator]();return{next:()=>{if(n)return{done:!0};const t=s.next(),r=o.next();return n=t.done||r.done,t.done||"function"!=typeof s.return||s.return(),r.done||"function"!=typeof o.return||o.return(),n?{done:!0}:{done:!1,value:e(t.value,r.value)}},return:e=>("function"==typeof s.return&&s.return(),"function"==typeof o.return&&o.return(),n=!0,{done:!0,value:e})}}}}function v(e,t){return b(((e,t)=>e===t),e,t)}function b(e,t,r){const n=t[Symbol.iterator](),s=r[Symbol.iterator]();for(;;){const t=n.next(),r=s.next();if(!t.done&&!r.done){if(e(t.value,r.value))continue;return!1}if(t.done&&r.done)return!0;if(!t.done)return"function"==typeof n.return&&n.return(),!1;if(!r.done)return"function"==typeof s.return&&s.return(),!1}return!0}t.OneToManyMap=class{constructor(){this._m=new Map}hasKey(e){return this._m.has(e)}keys(){return this._m.keys()}values(e){let t=this._m.get(e);return void 0!==t?t.values():h()}countKeys(){return this._m.size}count(e){let t=this._m.get(e);return void 0===t?0:t.size}addKey(e){return void 0===this._m.get(e)&&this._m.set(e,new Set),this}add(e,t){let r=this._m.get(e);return void 0===r&&(r=new Set,this._m.set(e,r)),r.add(t),this}addMany(e,t){let r=this._m.get(e);void 0===r&&(r=new Set,this._m.set(e,r));for(let e of t)r.add(e)}remove(e,t){let r=this._m.get(e);return void 0!==r&&r.delete(t)}removeKey(e){this._m.delete(e)}clear(){this._m.clear()}};let y=new WeakMap,g=new WeakMap,w=new WeakMap;function k(e){let t=y.get(e);if(n.hdconsole.assert(null!=t&&t>0,"trying to release an already released object"),--t,y.set(e,t),t>1)return t;if(1===t){let t=w.get(e);null!=t&&t(e)}else{let t=g.get(e);null!=t&&t(e)}return t}function S(e){let t=y.get(e);return void 0===t?0:t}t.RefList=class{constructor(){this._head=null}front(){if(null!=this._head)return this._head.data}pushFront(e){return this._head=new M(this._head,e),this._head}};class M{constructor(e,t){console.assert(S(t)>0),this.next=e,this.data=t}releaseTail(){let e=this.next;for(;null!=e;)k(e.data),e=e.next;this.next=null}}t.RefListNode=M;class x{constructor(e,t,r){this.prev=e,this.next=t,this.data=r}}t.ListNode=x;class O{constructor(){this._head=null,this._tail=null,this._size=0}insertNode(e,t){return null==e?(t.prev=this._tail,t.next=null,this._tail=t):(t.prev=e.prev,t.next=e,e.prev=t),null==t.prev?this._head=t:t.prev.next=t,this._size++,t}insert(e,t){return this.insertNode(e,new x(null,null,t))}pushFront(e){return this.insert(this._head,e)}pushNodeFront(e){return this.insertNode(this._head,e)}pushBack(e){return this.insert(null,e)}pushNodeBack(e){return this.insertNode(null,e)}removeNode(e){return null==e.next?this._tail=e.prev:e.next.prev=e.prev,null==e.prev?this._head=e.next:e.prev.next=e.next,this._size--,e}remove(e){return this.removeNode(e).data}popFront(){return null==this._head?null:this.remove(this._head)}popBack(){return null==this._tail?null:this.remove(this._tail)}[Symbol.iterator](){let e=this._head;return{next:()=>{if(null==e)return{done:!0};{let t={value:e.data,done:!1};return e=e.next,t}}}}reverseIterator(){let e=this._tail;return{next:()=>{if(null==e)return{done:!0};{let t={value:e.data,done:!1};return e=e.prev,t}}}}}t.LinkedList=O;class P{size(){return this._list._size}constructor(){this._nodeMap=new Map,this._list=new O,this._highestPriority=-1,this._lowestPriority=0}_access(e){let t=this._nodeMap.get(e);if(null==t&&console.log(e.name),null==t&&console.log(this.size()),n.hdconsole.assert(null!=t,"element not found in priority list"),null==t)throw"Should not happen, element not found in priority list";return t}remove(e){let t=this._nodeMap.get(e);null!=t&&(this._nodeMap.delete(e),this._list.remove(t))}promote(e){let t=this._access(e);t.data.priority=++this._highestPriority,this._list.pushNodeFront(this._list.removeNode(t))}demote(e){let t=this._access(e);t.data.priority=--this._lowestPriority,this._list.pushNodeBack(this._list.removeNode(t))}get highestPriority(){return this._highestPriority}get lowestPriority(){return this._lowestPriority}priority(e){return this._access(e).data.priority}pushBack(e){this._nodeMap.set(e,this._list.pushBack({data:e,priority:--this._lowestPriority}))}pushFront(e){this._nodeMap.set(e,this._list.pushFront({data:e,priority:++this._highestPriority}))}entries(){return p((e=>e.data),this)}[Symbol.iterator](){return this._list[Symbol.iterator]()}hasHigherPriority(e,t){return this._access(e).data.priority>this._access(t).data.priority}}t.PriorityList=P,t.ObservableReference=class{constructor(e=null){this._value=e,this._subject=new s.Subject((e=>{e.next(this._value)})),this._subscription=null}subscribe(e){return this._subject.subscribe(e)}get value(){return this._value}set value(e){null!=this._subscription&&(this._subscription.unsubscribe(),this._subscription=null),this._setValue(e)}_setValue(e){null!==this._value&&this._subject.sendNext(null),this._value=e,null!==e&&this._subject.sendNext(e)}link(e){this.value=null,this._subscription=e.subscribe((e=>{this._setValue(e)}))}},t.BinaryHeap=class{constructor(e){this._cmp=e,this._data=[null]}size(){return this._data.length-1}empty(){return 0===this.size()}_swap(e,t){let r=this._data[e];this._data[e]=this._data[t],this._data[t]=r}_percolateUp(e){for(;e>=2;){let t=Math.floor(e/2);if(!this._cmp(this._data[e],this._data[t]))break;this._swap(e,t),e=t}}push(e){this._data.push(e),this._percolateUp(this.size())}_percolateDown(e){for(;2*e<=this.size();){let t=this._minOfSiblings(2*e);if(this._cmp(this._data[e],this._data[t]))break;this._swap(e,t),e=t}}_minOfSiblings(e){return e>=this.size()||this._cmp(this._data[e],this._data[e+1])?e:e+1}pop(){let e=this._data[1],t=this._data.pop();return this.size()>0&&(this._data[1]=t,this._percolateDown(1)),e}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}var __webpack_exports__=__webpack_require__(707);return __webpack_exports__})()}));
//# sourceMappingURL=hotdrink.js.map